<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Julen Astigarraga and Ver√≥nica Cruz-Alonso">
<meta name="dcterms.date" content="2024-05-06">

<title>Functional Programming with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="intro_prog_fun_files/libs/clipboard/clipboard.min.js"></script>
<script src="intro_prog_fun_files/libs/quarto-html/quarto.js"></script>
<script src="intro_prog_fun_files/libs/quarto-html/popper.min.js"></script>
<script src="intro_prog_fun_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="intro_prog_fun_files/libs/quarto-html/anchor.min.js"></script>
<link href="intro_prog_fun_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="intro_prog_fun_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="intro_prog_fun_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="intro_prog_fun_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="intro_prog_fun_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#course-structure" id="toc-course-structure" class="nav-link" data-scroll-target="#course-structure"><span class="header-section-number">1.1</span> Course structure</a></li>
  <li><a href="#who-we-are" id="toc-who-we-are" class="nav-link" data-scroll-target="#who-we-are"><span class="header-section-number">1.2</span> Who we are?</a></li>
  </ul></li>
  <li><a href="#introduction-to-programming-in-tidyverse" id="toc-introduction-to-programming-in-tidyverse" class="nav-link" data-scroll-target="#introduction-to-programming-in-tidyverse"><span class="header-section-number">2</span> Introduction to programming in tidyverse</a>
  <ul class="collapse">
  <li><a href="#basic-concepts" id="toc-basic-concepts" class="nav-link" data-scroll-target="#basic-concepts"><span class="header-section-number">2.1</span> Basic concepts</a></li>
  <li><a href="#tidyverse" id="toc-tidyverse" class="nav-link" data-scroll-target="#tidyverse"><span class="header-section-number">2.2</span> Tidyverse</a></li>
  <li><a href="#scoping" id="toc-scoping" class="nav-link" data-scroll-target="#scoping"><span class="header-section-number">2.3</span> Scoping</a></li>
  </ul></li>
  <li><a href="#introduction-to-functional-programming" id="toc-introduction-to-functional-programming" class="nav-link" data-scroll-target="#introduction-to-functional-programming"><span class="header-section-number">3</span> Introduction to Functional Programming</a>
  <ul class="collapse">
  <li><a href="#when-do-we-have-to-use-a-function" id="toc-when-do-we-have-to-use-a-function" class="nav-link" data-scroll-target="#when-do-we-have-to-use-a-function"><span class="header-section-number">3.1</span> When do we have to use a function?</a></li>
  </ul></li>
  <li><a href="#theory-on-functions-in-r" id="toc-theory-on-functions-in-r" class="nav-link" data-scroll-target="#theory-on-functions-in-r"><span class="header-section-number">4</span> Theory on functions in R</a></li>
  <li><a href="#sec-writefun" id="toc-sec-writefun" class="nav-link" data-scroll-target="#sec-writefun"><span class="header-section-number">5</span> How to write functions</a>
  <ul class="collapse">
  <li><a href="#arguments" id="toc-arguments" class="nav-link" data-scroll-target="#arguments"><span class="header-section-number">5.1</span> Arguments</a></li>
  <li><a href="#return-values" id="toc-return-values" class="nav-link" data-scroll-target="#return-values"><span class="header-section-number">5.2</span> Return values</a></li>
  </ul></li>
  <li><a href="#object-oriented-programming-oop" id="toc-object-oriented-programming-oop" class="nav-link" data-scroll-target="#object-oriented-programming-oop"><span class="header-section-number">6</span> Object-oriented programming (OOP)</a></li>
  <li><a href="#functional-programming" id="toc-functional-programming" class="nav-link" data-scroll-target="#functional-programming"><span class="header-section-number">7</span> Functional programming</a></li>
  <li><a href="#iterations-over-one-argument" id="toc-iterations-over-one-argument" class="nav-link" data-scroll-target="#iterations-over-one-argument"><span class="header-section-number">8</span> Iterations over one argument</a>
  <ul class="collapse">
  <li><a href="#our-first-functional-generating-lists-map" id="toc-our-first-functional-generating-lists-map" class="nav-link" data-scroll-target="#our-first-functional-generating-lists-map"><span class="header-section-number">8.1</span> Our first functional: generating lists, <code>map()</code></a></li>
  <li><a href="#our-second-functional-generating-vectors-map_" id="toc-our-second-functional-generating-vectors-map_" class="nav-link" data-scroll-target="#our-second-functional-generating-vectors-map_"><span class="header-section-number">8.2</span> Our second functional: generating vectors, <code>map_*()</code></a></li>
  </ul></li>
  <li><a href="#iterations-over-multiple-arguments" id="toc-iterations-over-multiple-arguments" class="nav-link" data-scroll-target="#iterations-over-multiple-arguments"><span class="header-section-number">9</span> Iterations over multiple arguments</a>
  <ul class="collapse">
  <li><a href="#our-third-functional-two-inputs-map2" id="toc-our-third-functional-two-inputs-map2" class="nav-link" data-scroll-target="#our-third-functional-two-inputs-map2"><span class="header-section-number">9.1</span> Our third functional: two inputs, <code>map2()</code></a></li>
  <li><a href="#our-fourth-functional-multiple-inputs-pmap" id="toc-our-fourth-functional-multiple-inputs-pmap" class="nav-link" data-scroll-target="#our-fourth-functional-multiple-inputs-pmap"><span class="header-section-number">9.2</span> Our fourth functional: multiple inputs, <code>pmap()</code></a></li>
  </ul></li>
  <li><a href="#iterations-without-output" id="toc-iterations-without-output" class="nav-link" data-scroll-target="#iterations-without-output"><span class="header-section-number">10</span> Iterations without output</a>
  <ul class="collapse">
  <li><a href="#our-fifth-functional-walk-walk2-and-pwalk" id="toc-our-fifth-functional-walk-walk2-and-pwalk" class="nav-link" data-scroll-target="#our-fifth-functional-walk-walk2-and-pwalk"><span class="header-section-number">10.1</span> Our fifth functional: <code>walk()</code>, <code>walk2()</code> and <code>pwalk()</code></a></li>
  </ul></li>
  <li><a href="#function-operators-and-other-functionals" id="toc-function-operators-and-other-functionals" class="nav-link" data-scroll-target="#function-operators-and-other-functionals"><span class="header-section-number">11</span> Function operators and other functionals</a>
  <ul class="collapse">
  <li><a href="#more-variants-of-map-modify-and-imap" id="toc-more-variants-of-map-modify-and-imap" class="nav-link" data-scroll-target="#more-variants-of-map-modify-and-imap"><span class="header-section-number">11.1</span> More variants of <code>map()</code>: <code>modify()</code> and <code>imap()</code></a></li>
  <li><a href="#predicate-functionals-and-more-useful-stuff" id="toc-predicate-functionals-and-more-useful-stuff" class="nav-link" data-scroll-target="#predicate-functionals-and-more-useful-stuff"><span class="header-section-number">11.2</span> Predicate functionals and more useful stuff</a></li>
  </ul></li>
  <li><a href="#further-information" id="toc-further-information" class="nav-link" data-scroll-target="#further-information"><span class="header-section-number">12</span> Further information</a>
  <ul class="collapse">
  <li><a href="#parallelization" id="toc-parallelization" class="nav-link" data-scroll-target="#parallelization"><span class="header-section-number">12.1</span> Parallelization</a></li>
  <li><a href="#sec-OOP" id="toc-sec-OOP" class="nav-link" data-scroll-target="#sec-OOP"><span class="header-section-number">12.2</span> More information about Object-Oriented Programming (OOP)</a></li>
  <li><a href="#links-of-interest" id="toc-links-of-interest" class="nav-link" data-scroll-target="#links-of-interest"><span class="header-section-number">12.3</span> Links of interest</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="intro_prog_fun.md"><i class="bi bi-file-code"></i>Github (GFM)</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Functional Programming with R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Julen Astigarraga and Ver√≥nica Cruz-Alonso </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">05/06/2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>The objectives of this course are:</p>
<ul>
<li><p>to learn how to write functions</p></li>
<li><p>to apply functions in iterations using the library {purrr} from {tidyverse}</p></li>
<li><p>to learn coding styles that facilitate script understanding (üìù)</p></li>
</ul>
<p>Within the model of the tools needed in a typical data science project of Wickham and Grolemund (<a href="#fig-datascience" class="quarto-xref">Figure&nbsp;1</a>), this course focuses in the envelope wrapping all the other tools, that is, programming.</p>
<div id="fig-datascience" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-datascience-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/data-science.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-datascience-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Data science model of Wickham and Grolemund. https://r4ds.hadley.nz/intro#fig-ds-diagram
</figcaption>
</figure>
</div>
<section id="course-structure" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="course-structure"><span class="header-section-number">1.1</span> Course structure</h3>
<table class="table">
<colgroup>
<col style="width: 75%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th>Blocks</th>
<th>Day</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Course introduction</p>
<p>Refresh of tidyverse</p>
<p>Introduction to Functional Programming</p></td>
<td>27/05/24</td>
</tr>
<tr class="even">
<td><p>Theory of functions in R</p>
<p>How to write functions. Arguments and return values</p></td>
<td>27/05/24</td>
</tr>
<tr class="odd">
<td><p>Object-Oriented Programming</p>
<p>Functional Programming</p>
<p>Iterations over one argument</p></td>
<td>31/05/24</td>
</tr>
<tr class="even">
<td><p>Iterations over multiple arguments</p>
<p>Iterations without output</p>
<p>Function operators and other functionals</p></td>
<td>31/05/24</td>
</tr>
</tbody>
</table>
</section>
<section id="who-we-are" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="who-we-are"><span class="header-section-number">1.2</span> Who we are?</h3>
<p><img src="images/1_N_0YimgDh2_IbBT9jJNtOg.jpg" class="img-fluid"></p>
<p>We coordinate the <a href="https://ecoinfaeet.github.io/website/index.html">Ecoinformatics Working Group</a> of the Spanish Association of Terrestrial Ecology (AEET).</p>
<p>And you‚Ä¶ who are you?</p>
<p><a href="https://www.menti.com/alsrpp5991gr" class="uri">https://www.menti.com/alsrpp5991gr</a></p>
</section>
</section>
<section id="introduction-to-programming-in-tidyverse" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="introduction-to-programming-in-tidyverse"><span class="header-section-number">2</span> Introduction to programming in tidyverse</h2>
<section id="basic-concepts" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="basic-concepts"><span class="header-section-number">2.1</span> Basic concepts</h3>
<ul>
<li>Object: any element associated to a name. There are many different types: <code>numeric</code>, <code>integer</code>, <code>logical</code>, <code>data.frame</code>, <code>SpatVector</code>, etc.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>‚îÄ‚îÄ Attaching packages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse 1.3.2 ‚îÄ‚îÄ
‚úî ggplot2 3.4.2     ‚úî purrr   1.0.1
‚úî tibble  3.2.1     ‚úî dplyr   1.1.2
‚úî tidyr   1.3.0     ‚úî stringr 1.5.0
‚úî readr   2.1.2     ‚úî forcats 0.5.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tibble' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyr' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'purrr' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dplyr' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'stringr' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>‚îÄ‚îÄ Conflicts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse_conflicts() ‚îÄ‚îÄ
‚úñ dplyr::filter() masks stats::filter()
‚úñ dplyr::lag()    masks stats::lag()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"hi"</span>, <span class="st">"hola"</span>, <span class="st">"hola"</span>, <span class="st">"hi"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>mymatrix_num <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(a, b), <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>mymatrix_num</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    1    1
[2,]    2    2
[3,]    3    3
[4,]    4    4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mymatrix_cha <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(a, b, c), <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>mymatrix_cha</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]  
[1,] "1"  "1"  "hi"  
[2,] "2"  "2"  "hola"
[3,] "3"  "3"  "hola"
[4,] "4"  "4"  "hi"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>mytibble <span class="ot">&lt;-</span> <span class="fu">tibble</span>(a, b, c)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>mytibble</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 3
      a     b c    
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
1     1     1 hi   
2     2     2 hola 
3     3     3 hola 
4     4     4 hi   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mydf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(a, b, c)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>mylist <span class="ot">&lt;-</span> <span class="fu">list</span>(a, b, c, d)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>mylist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 1 2 3 4

[[2]]
[1] 1 2 3 4

[[3]]
[1] "hi"   "hola" "hola" "hi"  

[[4]]
[1]  TRUE  TRUE  TRUE FALSE FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>mylist_from_tibble <span class="ot">&lt;-</span> mytibble <span class="sc">|&gt;</span> <span class="co"># list</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_split</span>(c)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>mylist_from_tibble</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;list_of&lt;
  tbl_df&lt;
    a: double
    b: double
    c: character
  &gt;
&gt;[2]&gt;
[[1]]
# A tibble: 2 √ó 3
      a     b c    
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
1     1     1 hi   
2     4     4 hi   

[[2]]
# A tibble: 2 √ó 3
      a     b c    
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
1     2     2 hola 
2     3     3 hola </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>mynested_tibble <span class="ot">&lt;-</span> mytibble <span class="sc">|&gt;</span> <span class="co"># data.frame with list-columns</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(c) <span class="sc">|&gt;</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>()</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>mynested_tibble</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 √ó 2
# Groups:   c [2]
  c     data            
  &lt;chr&gt; &lt;list&gt;          
1 hi    &lt;tibble [2 √ó 2]&gt;
2 hola  &lt;tibble [2 √ó 2]&gt;</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Names have objects; objects don‚Äôt have names</p>
<p>‚Äî Hadley Wickham (<a href="https://adv-r.hadley.nz/index.html">Advanced R</a>)</p>
</blockquote>
<p>In the example above, the length 4 numeric vector <code>c(1, 2, 3, 4)</code> (object) has two names: ‚Äúa‚Äù and ‚Äúb‚Äù.</p>
<p>üí°By doing <code>mean(x = a)</code> we link the value of ‚Äúa‚Äù with the name ‚Äúx‚Äù as well. This link is called a <em>promise</em> in R: it is a promise to provide the value of ‚Äúa‚Äù, if ‚Äúx‚Äù is ever needed within the <code>sum()</code> function.</p>
<p>üìùObject names should be descriptive and can not have some special characters (<code>^</code>, <code>!</code>, <code>$</code>, <code>@</code>, <code>+</code>, <code>-</code>, <code>/</code>, <code>*</code>).</p>
<p>üìùR is sensitive to capital letters. In general, it is better to avoid them.</p>
<ul>
<li><p>Functions: objects in R that take an input and give an output doing a specific action (specific functionality). Functions are the fundamental <em>building blocks</em> in R which is a functional programming language.</p>
<p><img src="images/function.png" class="img-fluid"></p></li>
</ul>
<blockquote class="blockquote">
<p>To understand computation in R, this two truths are very useful:</p>
<p>- Everything that exist in R in an object.</p>
<p>- Everything that happen in R is the result of a function call.</p>
<p>‚Äî John Chambers (<a href="https://adv-r.hadley.nz/index.html">Advanced R</a>)</p>
</blockquote>
<ul>
<li>Libraries or packages: hold reusable functions, documentation on how to use them and example data. They are the fundamental units of reproducible code in R.</li>
</ul>
<p>üí°More info about Three Deep Truths About R <a href="https://www.r-bloggers.com/2018/06/three-deep-truths-about-r/">here</a>.</p>
</section>
<section id="tidyverse" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="tidyverse"><span class="header-section-number">2.2</span> Tidyverse</h3>
<p><a href="https://www.tidyverse.org/"><em>Tidyverse</em></a> is a collection of R packages (meta-package) initially developed by Hadley Wickham. It contains eight main packages: <code>readr</code>, <code>tibble</code>, <code>dplyr</code>, <code>tidyr</code>, <code>stringr</code>, <code>forcats</code>, <code>ggplot2</code> and <code>purrr</code>. <em>Tidyverse</em> can be considered a dialect of the R programming language, and as such, it may be difficult to learn for people with experience in base R. However, it is important to know the basics of programming using <em>Tidyverse</em> for this course due to consistency with the sections on iteration where we will primarily use {purrr}.</p>
<p><em>Tidyverse</em> is designed to support the activities of a human data analyst, making its programming structures more logical for the human mind. All the packages are designed to work with <a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html"><em>tidy data</em></a> meaning data where each column is a variable, each row is an observation, and each cell has a value. Additionally, the functions are prepared to be concatenated using the <em>pipe</em> operator (<code>%&gt;%</code> from {magrittr} package or <code>|&gt;</code> from base R), which takes what is on its left and uses it as the first argument of the function on its right. This allows for a left-to-right reading flow, which is more comfortable for most people.</p>
<p>üí°The two pipe operators have small <a href="https://www.tidyverse.org/blog/2023/04/base-vs-magrittr-pipe/">differences</a> but in general their behaviour is the same.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>myvector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">4</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(myvector)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>myvector <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>() <span class="co"># CTRL+SHIFT+M - shortcut for the pipe</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(myvector)) <span class="co"># vs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>myvector <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">length</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>penguins <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>penguins</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 √ó 8
   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
 1 Adelie  Torgersen           39.1          18.7               181        3750
 2 Adelie  Torgersen           39.5          17.4               186        3800
 3 Adelie  Torgersen           40.3          18                 195        3250
 4 Adelie  Torgersen           NA            NA                  NA          NA
 5 Adelie  Torgersen           36.7          19.3               193        3450
 6 Adelie  Torgersen           39.3          20.6               190        3650
 7 Adelie  Torgersen           38.9          17.8               181        3625
 8 Adelie  Torgersen           39.2          19.6               195        4675
 9 Adelie  Torgersen           34.1          18.1               193        3475
10 Adelie  Torgersen           42            20.2               190        4250
# ‚Ñπ 334 more rows
# ‚Ñπ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      species          island    bill_length_mm  bill_depth_mm  
 Adelie   :152   Biscoe   :168   Min.   :32.10   Min.   :13.10  
 Chinstrap: 68   Dream    :124   1st Qu.:39.23   1st Qu.:15.60  
 Gentoo   :124   Torgersen: 52   Median :44.45   Median :17.30  
                                 Mean   :43.92   Mean   :17.15  
                                 3rd Qu.:48.50   3rd Qu.:18.70  
                                 Max.   :59.60   Max.   :21.50  
                                 NA's   :2       NA's   :2      
 flipper_length_mm  body_mass_g       sex           year     
 Min.   :172.0     Min.   :2700   female:165   Min.   :2007  
 1st Qu.:190.0     1st Qu.:3550   male  :168   1st Qu.:2007  
 Median :197.0     Median :4050   NA's  : 11   Median :2008  
 Mean   :200.9     Mean   :4202                Mean   :2008  
 3rd Qu.:213.0     3rd Qu.:4750                3rd Qu.:2009  
 Max.   :231.0     Max.   :6300                Max.   :2009  
 NA's   :2         NA's   :2                                 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(penguins)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># filter</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(island <span class="sc">==</span> <span class="st">"Dream"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 124 √ó 8
   species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
   &lt;fct&gt;   &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
 1 Adelie  Dream            39.5          16.7               178        3250
 2 Adelie  Dream            37.2          18.1               178        3900
 3 Adelie  Dream            39.5          17.8               188        3300
 4 Adelie  Dream            40.9          18.9               184        3900
 5 Adelie  Dream            36.4          17                 195        3325
 6 Adelie  Dream            39.2          21.1               196        4150
 7 Adelie  Dream            38.8          20                 190        3950
 8 Adelie  Dream            42.2          18.5               180        3550
 9 Adelie  Dream            37.6          19.3               181        3300
10 Adelie  Dream            39.8          19.1               184        4650
# ‚Ñπ 114 more rows
# ‚Ñπ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(island <span class="sc">==</span> <span class="st">"Dream"</span> <span class="sc">&amp;</span> body_mass_g <span class="sc">&gt;</span> <span class="dv">4500</span>) <span class="co"># Combining criteria</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 8
  species   island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;     &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Adelie    Dream            39.8          19.1               184        4650
2 Adelie    Dream            39.6          18.8               190        4600
3 Chinstrap Dream            52.8          20                 205        4550
4 Chinstrap Dream            52            20.7               210        4800
# ‚Ñπ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(island <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Dream"</span>, <span class="st">"Torgersen"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 176 √ó 8
   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
 1 Adelie  Torgersen           39.1          18.7               181        3750
 2 Adelie  Torgersen           39.5          17.4               186        3800
 3 Adelie  Torgersen           40.3          18                 195        3250
 4 Adelie  Torgersen           NA            NA                  NA          NA
 5 Adelie  Torgersen           36.7          19.3               193        3450
 6 Adelie  Torgersen           39.3          20.6               190        3650
 7 Adelie  Torgersen           38.9          17.8               181        3625
 8 Adelie  Torgersen           39.2          19.6               195        4675
 9 Adelie  Torgersen           34.1          18.1               193        3475
10 Adelie  Torgersen           42            20.2               190        4250
# ‚Ñπ 166 more rows
# ‚Ñπ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sex, body_mass_g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 √ó 2
   sex    body_mass_g
   &lt;fct&gt;        &lt;int&gt;
 1 male          3750
 2 female        3800
 3 female        3250
 4 &lt;NA&gt;            NA
 5 female        3450
 6 male          3650
 7 female        3625
 8 male          4675
 9 &lt;NA&gt;          3475
10 &lt;NA&gt;          4250
# ‚Ñπ 334 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="fu">c</span>(<span class="st">"mm"</span>, <span class="st">"g"</span>))) <span class="co"># select variables with a text pattern</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 √ó 4
   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
            &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
 1           39.1          18.7               181        3750
 2           39.5          17.4               186        3800
 3           40.3          18                 195        3250
 4           NA            NA                  NA          NA
 5           36.7          19.3               193        3450
 6           39.3          20.6               190        3650
 7           38.9          17.8               181        3625
 8           39.2          19.6               195        4675
 9           34.1          18.1               193        3475
10           42            20.2               190        4250
# ‚Ñπ 334 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sex, body_mass_g, <span class="fu">everything</span>()) <span class="co"># use select to reorder variables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 √ó 8
   sex    body_mass_g species island    bill_length_mm bill_depth_mm
   &lt;fct&gt;        &lt;int&gt; &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;
 1 male          3750 Adelie  Torgersen           39.1          18.7
 2 female        3800 Adelie  Torgersen           39.5          17.4
 3 female        3250 Adelie  Torgersen           40.3          18  
 4 &lt;NA&gt;            NA Adelie  Torgersen           NA            NA  
 5 female        3450 Adelie  Torgersen           36.7          19.3
 6 male          3650 Adelie  Torgersen           39.3          20.6
 7 female        3625 Adelie  Torgersen           38.9          17.8
 8 male          4675 Adelie  Torgersen           39.2          19.6
 9 &lt;NA&gt;          3475 Adelie  Torgersen           34.1          18.1
10 &lt;NA&gt;          4250 Adelie  Torgersen           42            20.2
# ‚Ñπ 334 more rows
# ‚Ñπ 2 more variables: flipper_length_mm &lt;int&gt;, year &lt;int&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sex, body_mass_g) <span class="sc">|&gt;</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(body_mass_g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 √ó 2
   sex    body_mass_g
   &lt;fct&gt;        &lt;int&gt;
 1 female        2700
 2 female        2850
 3 female        2850
 4 female        2900
 5 female        2900
 6 female        2900
 7 female        2900
 8 female        2925
 9 &lt;NA&gt;          2975
10 female        3000
# ‚Ñπ 334 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sex, body_mass_g) <span class="sc">|&gt;</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(body_mass_g))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 √ó 2
   sex   body_mass_g
   &lt;fct&gt;       &lt;int&gt;
 1 male         6300
 2 male         6050
 3 male         6000
 4 male         6000
 5 male         5950
 6 male         5950
 7 male         5850
 8 male         5850
 9 male         5850
10 male         5800
# ‚Ñπ 334 more rows</code></pre>
</div>
</div>
<section id="exercise" class="level4" data-number="2.2.1">
<h4 data-number="2.2.1" class="anchored" data-anchor-id="exercise"><span class="header-section-number">2.2.1</span> Exercise</h4>
<ol type="1">
<li><p>With the penguins dataset, create an object with individuals of the Adelie species and arrange the <code>data.frame</code> according to flipper length.</p></li>
<li><p>Create an object from the previous one where you select the island and the variables related to the bill.</p></li>
<li><p>Create an object from the one created in step 1 where you select everything except the species.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mutate</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bill_volume_mm2 =</span> (bill_length_mm <span class="sc">*</span> bill_depth_mm) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(bill_volume_mm2, <span class="fu">everything</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 √ó 9
   bill_volume_mm2 species island bill_length_mm bill_depth_mm flipper_length_mm
             &lt;dbl&gt; &lt;fct&gt;   &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;
 1            366. Adelie  Torge‚Ä¶           39.1          18.7               181
 2            344. Adelie  Torge‚Ä¶           39.5          17.4               186
 3            363. Adelie  Torge‚Ä¶           40.3          18                 195
 4             NA  Adelie  Torge‚Ä¶           NA            NA                  NA
 5            354. Adelie  Torge‚Ä¶           36.7          19.3               193
 6            405. Adelie  Torge‚Ä¶           39.3          20.6               190
 7            346. Adelie  Torge‚Ä¶           38.9          17.8               181
 8            384. Adelie  Torge‚Ä¶           39.2          19.6               195
 9            309. Adelie  Torge‚Ä¶           34.1          18.1               193
10            424. Adelie  Torge‚Ä¶           42            20.2               190
# ‚Ñπ 334 more rows
# ‚Ñπ 3 more variables: body_mass_g &lt;int&gt;, sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">female_penguin =</span> <span class="fu">case_when</span>(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    sex <span class="sc">==</span> <span class="st">"female"</span> <span class="sc">&amp;</span> body_mass_g <span class="sc">&lt;</span> <span class="dv">3600</span> <span class="sc">~</span> <span class="st">"small female"</span>,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    sex <span class="sc">==</span> <span class="st">"female"</span> <span class="sc">&amp;</span> body_mass_g <span class="sc">&gt;=</span> <span class="dv">3600</span> <span class="sc">~</span> <span class="st">"big female"</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span>)) <span class="sc">|&gt;</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(female_penguin, sex, body_mass_g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 √ó 3
   female_penguin sex    body_mass_g
   &lt;chr&gt;          &lt;fct&gt;        &lt;int&gt;
 1 &lt;NA&gt;           male          3750
 2 big female     female        3800
 3 small female   female        3250
 4 &lt;NA&gt;           &lt;NA&gt;            NA
 5 small female   female        3450
 6 &lt;NA&gt;           male          3650
 7 big female     female        3625
 8 &lt;NA&gt;           male          4675
 9 &lt;NA&gt;           &lt;NA&gt;          3475
10 &lt;NA&gt;           &lt;NA&gt;          4250
# ‚Ñπ 334 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summarise</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co"># it is used with summary functions: n, n_distinct, mean, etc.</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># see ?summarise</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">body_min =</span> <span class="fu">min</span>(body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">body_max =</span> <span class="fu">max</span>(body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 2
  body_min body_max
     &lt;int&gt;    &lt;int&gt;
1     2700     6300</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex) <span class="sc">|&gt;</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">body_min =</span> <span class="fu">min</span>(body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">body_max =</span> <span class="fu">max</span>(body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 3
  sex    body_min body_max
  &lt;fct&gt;     &lt;int&gt;    &lt;int&gt;
1 female     2700     5200
2 male       3250     6300
3 &lt;NA&gt;       2975     4875</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># join: left, right, full, inner</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>coordinates <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">island =</span> <span class="fu">c</span>(<span class="st">"Dream"</span>, <span class="st">"Torgersen"</span>, <span class="st">"Biscoe"</span>), </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">latitude =</span> <span class="fu">c</span>(<span class="st">"64¬∞44‚Ä≤S"</span>, <span class="st">"64¬∞46‚Ä≤S"</span>, <span class="st">"64¬∞36‚Ä≤S"</span>),</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">longitude =</span> <span class="fu">c</span>(<span class="st">"64¬∞14‚Ä≤W"</span>, <span class="st">"64¬∞05‚Ä≤W"</span>, <span class="st">" 63¬∞30‚Ä≤W"</span>))</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(coordinates, <span class="at">by =</span> <span class="st">"island"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(island, latitude, longitude, <span class="fu">everything</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 √ó 10
   island    latitude longitude species bill_length_mm bill_depth_mm
   &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;     &lt;fct&gt;            &lt;dbl&gt;         &lt;dbl&gt;
 1 Torgersen 64¬∞46‚Ä≤S  64¬∞05‚Ä≤W   Adelie            39.1          18.7
 2 Torgersen 64¬∞46‚Ä≤S  64¬∞05‚Ä≤W   Adelie            39.5          17.4
 3 Torgersen 64¬∞46‚Ä≤S  64¬∞05‚Ä≤W   Adelie            40.3          18  
 4 Torgersen 64¬∞46‚Ä≤S  64¬∞05‚Ä≤W   Adelie            NA            NA  
 5 Torgersen 64¬∞46‚Ä≤S  64¬∞05‚Ä≤W   Adelie            36.7          19.3
 6 Torgersen 64¬∞46‚Ä≤S  64¬∞05‚Ä≤W   Adelie            39.3          20.6
 7 Torgersen 64¬∞46‚Ä≤S  64¬∞05‚Ä≤W   Adelie            38.9          17.8
 8 Torgersen 64¬∞46‚Ä≤S  64¬∞05‚Ä≤W   Adelie            39.2          19.6
 9 Torgersen 64¬∞46‚Ä≤S  64¬∞05‚Ä≤W   Adelie            34.1          18.1
10 Torgersen 64¬∞46‚Ä≤S  64¬∞05‚Ä≤W   Adelie            42            20.2
# ‚Ñπ 334 more rows
# ‚Ñπ 4 more variables: flipper_length_mm &lt;int&gt;, body_mass_g &lt;int&gt;, sex &lt;fct&gt;,
#   year &lt;int&gt;</code></pre>
</div>
</div>
</section>
<section id="exercise-1" class="level4" data-number="2.2.2">
<h4 data-number="2.2.2" class="anchored" data-anchor-id="exercise-1"><span class="header-section-number">2.2.2</span> Exercise</h4>
<ol type="1">
<li><p>With the penguins dataset, count the number of cases on each island and calculate the mean flipper length for each island.</p></li>
<li><p>Calculate the ratio between the weight in kg and the flipper length for each individual.</p></li>
</ol>
</section>
</section>
<section id="scoping" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="scoping"><span class="header-section-number">2.3</span> Scoping</h3>
<p><a href="https://adv-r.hadley.nz/functions.html?q=lexica#lexical-scoping">Scoping</a> is the set of rules that govern how to look up the value of a symbol in the environment in each programming language. R uses <em>lexical scoping</em> and there are four basic rules: name masking, functions versus variables, a fresh start and dynamic lookup. A deeper understanding of scoping will help us to use more advanced functional programming tools.</p>
<p>In relation to name masking, the basic principle of&nbsp;lexical&nbsp;scoping is that names defined inside a function mask names defined outside a function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>myfunction <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> y</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="fu">myfunction</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/environment.png" class="img-fluid figure-img"></p>
<figcaption>If a name isn‚Äôt defined inside a function, R will look one level up. Art by Cristina Grajera</figcaption>
</figure>
</div>
<p>In general, with base R, we can only call objects that are part of the environment (env-variables); however, with <em>tidyverse</em>, we can also call variables within tables (data-variables). This feature called <em>data masking</em> simplifies the code in <em>tidyverse</em>, but the advantage does not come for free and has implications for the grammar of the functions as we will see later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> <span class="fu">filter</span>(island <span class="sc">==</span> <span class="st">"Dream"</span>, species <span class="sc">==</span> <span class="st">"Chinstrap"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 68 √ó 8
   species   island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
   &lt;fct&gt;     &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
 1 Chinstrap Dream            46.5          17.9               192        3500
 2 Chinstrap Dream            50            19.5               196        3900
 3 Chinstrap Dream            51.3          19.2               193        3650
 4 Chinstrap Dream            45.4          18.7               188        3525
 5 Chinstrap Dream            52.7          19.8               197        3725
 6 Chinstrap Dream            45.2          17.8               198        3950
 7 Chinstrap Dream            46.1          18.2               178        3250
 8 Chinstrap Dream            51.3          18.2               197        3750
 9 Chinstrap Dream            46            18.9               195        4150
10 Chinstrap Dream            51.3          19.9               198        3700
# ‚Ñπ 58 more rows
# ‚Ñπ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>penguins[penguins<span class="sc">$</span>island <span class="sc">==</span> <span class="st">"Dream"</span> <span class="sc">&amp;</span> penguins<span class="sc">$</span>species <span class="sc">==</span> <span class="st">"Chinstrap"</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 68 √ó 8
   species   island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
   &lt;fct&gt;     &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
 1 Chinstrap Dream            46.5          17.9               192        3500
 2 Chinstrap Dream            50            19.5               196        3900
 3 Chinstrap Dream            51.3          19.2               193        3650
 4 Chinstrap Dream            45.4          18.7               188        3525
 5 Chinstrap Dream            52.7          19.8               197        3725
 6 Chinstrap Dream            45.2          17.8               198        3950
 7 Chinstrap Dream            46.1          18.2               178        3250
 8 Chinstrap Dream            51.3          18.2               197        3750
 9 Chinstrap Dream            46            18.9               195        4150
10 Chinstrap Dream            51.3          19.9               198        3700
# ‚Ñπ 58 more rows
# ‚Ñπ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="at">x =</span> values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in mean(x = values): object 'values' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">values =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="at">x =</span> values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in mean(x = values): object 'values' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="at">x =</span> mydata<span class="sc">$</span>values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>mydata <span class="sc">|&gt;</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(values))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 1
   mean
  &lt;dbl&gt;
1   5.5</code></pre>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/data_masking.png" class="img-fluid figure-img"></p>
<figcaption>Data masking in <em>tidyverse</em> allows to use data-variables (toys within the box ‚Äìthe tibble) as if they were env-variables (toys all around the carpets). When Monchi uses the <em>tidyglasses</em> he could access as well to the toys within the box. Art by Cristina Grajera</figcaption>
</figure>
</div>
</section>
</section>
<section id="introduction-to-functional-programming" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="introduction-to-functional-programming"><span class="header-section-number">3</span> Introduction to Functional Programming</h2>
<p>The growing availability of data and the versatility of analysis software have led to an increase in the quantity and complexity of the analyses we conduct in biological sciences. This makes efficiency in the process of data management and analysis increasingly necessary. One possible way to optimize these processes and reduce work time for R users is function-based programming. Functions allow the automation of common tasks (for example, reading different databases), simplifying the code.</p>
<p>A function can be called through another function and the process can be iterated, making R a very powerful tool. Iterations are used to perform the same action on multiple inputs. There are two main paradigms of iteration: object-oriented programming (OOP) and functional programming (FP). In this workshop, we will primarily focus on functional programming and learn to use the {purrr} package, which provides functions to eliminate many common loops.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> penguins <span class="sc">|&gt;</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>df_rescaled1 <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bill_length_mm =</span> (bill_length_mm <span class="sc">-</span> <span class="fu">min</span>(bill_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> (<span class="fu">max</span>(bill_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(bill_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">bill_depth_mm =</span> (bill_depth_mm <span class="sc">-</span> <span class="fu">min</span>(bill_depth_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> (<span class="fu">max</span>(bill_depth_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(bill_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">flipper_length_mm =</span> (flipper_length_mm <span class="sc">-</span> <span class="fu">min</span>(flipper_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> (<span class="fu">max</span>(flipper_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(flipper_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">body_mass_g =</span> (body_mass_g <span class="sc">-</span> <span class="fu">min</span>(body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> (<span class="fu">max</span>(body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(df_rescaled1)</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>rescale01 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>  rng <span class="ot">&lt;-</span> <span class="fu">range</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)   </span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> rng[<span class="dv">1</span>]) <span class="sc">/</span> (rng[<span class="dv">2</span>] <span class="sc">-</span> rng[<span class="dv">1</span>]) </span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>df_rescaled2 <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bill_length_mm =</span> <span class="fu">rescale01</span>(bill_length_mm),</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">bill_depth_mm =</span> <span class="fu">rescale01</span>(bill_depth_mm),</span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">flipper_length_mm =</span> <span class="fu">rescale01</span>(flipper_length_mm), </span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">body_mass_g =</span> <span class="fu">rescale01</span>(body_mass_g))  </span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(df_rescaled2)</span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>df_rescaled3 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(df, rescale01)</span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_rescaled3<span class="sc">$</span>bill_length_mm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2545455 0.2690909 0.2981818        NA 0.1672727 0.2618182</code></pre>
</div>
</div>
<p>The main advantages of functional programming (use of functions and iterations) are:</p>
<ol type="1">
<li><p>Ease of understanding the code‚Äôs intent, thereby improving comprehension for oneself, collaborators, and reviewers:</p>
<ul>
<li><p>Functions have evocative names.</p></li>
<li><p>The code is more organized.</p></li>
</ul></li>
<li><p>Speed in making changes, as functions are independent pieces that solve a specific problem.</p></li>
<li><p>Reduction of error probability.</p></li>
</ol>
<section id="when-do-we-have-to-use-a-function" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="when-do-we-have-to-use-a-function"><span class="header-section-number">3.1</span> When do we have to use a function?</h3>
<p>It is recommended to follow the ‚Äúdo not repeat yourself‚Äù principle (<a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself#:~:text=%22Don't%20repeat%20yourself%22,redundancy%20in%20the%20first%20place.">DRY principle</a>): each unit of knowledge or information should have a single, unambiguous, and authoritative representation within a system.</p>
<p>Writing a function is worthwhile when you have copied and pasted the same code more than twice (don‚Äôt be WET! - Write Everything Twice). The more times a piece of code is repeated in different places, the more you will need to update it if there is a change, and the higher the likelihood of errors.</p>
</section>
</section>
<section id="theory-on-functions-in-r" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="theory-on-functions-in-r"><span class="header-section-number">4</span> Theory on functions in R</h2>
<p>Functions have three components:</p>
<ul>
<li><code>body()</code>: the code inside the function.</li>
<li><code>formals()</code>: the list of arguments that control how the function is executed.</li>
<li><code>environment()</code>: the structure that supports the <em>scoping</em> of the function, i.e., the environment where the function is located.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(rescale01)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{
    rng &lt;- range(x, na.rm = TRUE)
    (x - rng[1])/(rng[2] - rng[1])
}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">formals</span>(rescale01)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$x</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>(rescale01)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;environment: R_GlobalEnv&gt;</code></pre>
</div>
</div>
<p><strong>Primitive functions</strong> are the exception as they do not have the aforementioned components. They are written in C instead of R and only appear in the base package. They are more efficient but behave differently from other functions, so the R Core Team tries not to create new primitive functions. The rest of the functions follow the structure outlined above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>sum</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (..., na.rm = FALSE)  .Primitive("sum")</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(sum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<p>According to the type of output, there are two types of functions:</p>
<ul>
<li><p><strong>Transformation functions</strong>: transform the object that enters the function (the first argument) and return another object or the original one with modifications. Functionals are special types of transformation functions.</p></li>
<li><p><strong>Side-effect functions</strong>: have side effects and perform an action, such as saving a file or drawing a plot. Some commonly used examples are: <code>library()</code>, <code>setwd()</code>, <code>plot()</code>, <code>write_delim()</code>‚Ä¶ These functions invisibly return the output, which is not saved but can be used in a pipeline.</p></li>
</ul>
<p>In general, syntactically, functions have three components:</p>
<ul>
<li>The function <code>function()</code> (primitive)</li>
<li>Arguments: list of inputs.</li>
<li>Body: the piece of code that follows <code>function()</code>, traditionally enclosed in curly braces.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>name1_v1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(x, y, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>}  </span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>name1_v2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) <span class="fu">paste</span>(x, y, <span class="at">sep =</span> <span class="st">"_"</span>)  </span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>name1_v3 <span class="ot">&lt;-</span> \(x, y) <span class="fu">paste</span>(x, y, <span class="at">sep =</span> <span class="st">"_"</span>)  </span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="fu">name1_v1</span>(<span class="st">"Vero"</span>, <span class="st">"Cruz"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Vero_Cruz"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name1_v2</span>(<span class="st">"Vero"</span>, <span class="st">"Cruz"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Vero_Cruz"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name1_v3</span>(<span class="st">"Vero"</span>, <span class="st">"Cruz"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Vero_Cruz"</code></pre>
</div>
</div>
<p>üìùIf the function has more than two lines, it is better to always use curly braces to clearly delimit it. The opening brace should never be alone, but the closing one should be (except with <code>else</code>). Indentation also greatly helps to understand the hierarchy of the code within functions. In this regard, we recommend using <em>Code &gt; Reindent lines/Reformat code</em> in the RStudio menu.</p>
<p>üí°Infix operators (<code>+</code>), flow control operators (<code>for</code>, <code>if</code>), subsetting operators (<code>[ ]</code>, <code>$</code>), assignment operators (<code>&lt;-</code>) or even curly braces (<code>{ }</code>) are also functions. The backtick ‚Äú`‚Äù allows to refer to functions or variables that otherwise have ‚Äúillegal‚Äù names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">+</span> <span class="dv">2</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="dv">3</span>, <span class="dv">2</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="fu">print</span>(i) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1
[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">for</span><span class="st">`</span>(i, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="fu">print</span>(i)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1
[1] 2</code></pre>
</div>
</div>
<p>In general, functions have a name that is executed when needed, as we have seen so far, but this is not mandatory. Some packages, such as {purrr}, or functions from the <code>apply</code> family, allow the use of anonymous functions for iteration.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>nxcase <span class="ot">&lt;-</span> <span class="fu">lapply</span>(penguins, <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)))</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> penguins<span class="sc">|&gt;</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_split</span>(species) <span class="sc">|&gt;</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(\(df) <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> bill_length_mm, <span class="at">data =</span> df)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>üìùIt is better to reserve the use of anonymous functions for short and simple functions. If the function is long, spans multiple lines or we need to use it many times it is better to give it a name.</p>
</section>
<section id="sec-writefun" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="sec-writefun"><span class="header-section-number">5</span> How to write functions</h2>
<section id="exercise-2" class="level4" data-number="5.0.1">
<h4 data-number="5.0.1" class="anchored" data-anchor-id="exercise-2"><span class="header-section-number">5.0.1</span> Exercise</h4>
<p>Create your first function that fulfills the functionality of dividing any value by 100.</p>
<p>üí°Shortcut to write functions: write word ‚Äúfun‚Äù + tab.</p>
<p>Imagine that for a dataset we want to visualize the distribution for each numerical variable, based on other categorical variables that particularly interests us.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>penguins_num <span class="ot">&lt;-</span> penguins <span class="sc">|&gt;</span> </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(species, sex, <span class="fu">where</span>(is.numeric))</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="co"># we are interested in differences among species and between sexes </span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins_num, <span class="fu">aes</span>(<span class="at">x =</span> species, <span class="at">y =</span> bill_length_mm, <span class="at">color =</span> sex)) <span class="sc">+</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitterdodge</span>(), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"turquoise"</span>, <span class="st">"goldenrod1"</span>)) <span class="sc">+</span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_prog_fun_files/figure-html/repeated_code_advanced-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins_num, <span class="fu">aes</span>(<span class="at">x =</span> species, <span class="at">y =</span> bill_depth_mm, <span class="at">color =</span> sex)) <span class="sc">+</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitterdodge</span>(), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"turquoise"</span>, <span class="st">"goldenrod1"</span>)) <span class="sc">+</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_prog_fun_files/figure-html/repeated_code_advanced-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins_num, <span class="fu">aes</span>(<span class="at">x =</span> species, <span class="at">y =</span> flipper_length_mm, <span class="at">color =</span> sex)) <span class="sc">+</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitterdodge</span>(), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"turquoise"</span>, <span class="st">"goldenrod1"</span>)) <span class="sc">+</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_prog_fun_files/figure-html/repeated_code_advanced-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># etc</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have copied a code more than twice to perform the same action (i.e., a plot to see how a variable is distributed based on two others that remain constant), so we should consider the possibility that we need a function. Next, we will follow some simple steps to transform any repeated code into a function.</p>
<ol type="1">
<li><p>Analyze the code: what are the replicated parts? How many inputs do we have? Which inputs vary and which do not?</p></li>
<li><p>Simplify and reanalyze duplications.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>var <span class="ot">&lt;-</span> penguins_num<span class="sc">$</span>bill_length_mm</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins_num, <span class="fu">aes</span>(<span class="at">x =</span> species, <span class="at">y =</span> var, <span class="at">color =</span> sex)) <span class="sc">+</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitterdodge</span>(), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"turquoise"</span>, <span class="st">"goldenrod1"</span>)) <span class="sc">+</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_prog_fun_files/figure-html/function_simplify-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>var <span class="ot">&lt;-</span> body_mass_g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'body_mass_g' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>var <span class="ot">&lt;-</span> <span class="st">"body_mass_g"</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins_num, <span class="fu">aes</span>(<span class="at">x =</span> species, <span class="at">y =</span> .data[[var]], <span class="at">color =</span> sex)) <span class="sc">+</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitterdodge</span>(), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"turquoise"</span>, <span class="st">"goldenrod1"</span>)) <span class="sc">+</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_prog_fun_files/figure-html/function_simplify_2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>üëÄ <code>ggplot()</code> needs arguments (data-variables) that are within the data frame it will represent. To generalize the function, we have associated the name of the variable (of type character) to the name ‚Äúvar‚Äù, but <code>ggplot()</code> does not accept characters. Therefore, we need to use an intermediate function that does accept them.</p>
<p>üìù Creating objects with intermediate calculations within a function is good practice because it makes the code clearer about what the function is doing. It is common when the function contains if/else statements.</p>
<ol start="3" type="1">
<li><p>Choose a name for the function (üìù). Ideally, it should be short and evoke what the function does. In general, it should be a verb (e.g.&nbsp;impute_values) and the argument names are nouns (e.g.&nbsp;‚Äúdata‚Äù, ‚Äúvariable‚Äù, etc.). Using a noun for a function is allowed if the function calculates something well-known (e.g.&nbsp;<code>mean()</code>) or if it serves to access parts of an object (e.g.&nbsp;<code>residuals()</code>). It is also recommended to avoid very generic verbs (e.g.&nbsp;‚Äúcalculate‚Äù), and if the name has multiple words, to separate them with an underscore, a dot or use camelCase, but be consistent. If you program several function that do similar things, it is recommended to use the same prefix for all of them (e.g.&nbsp;‚Äústr_‚Äù in {stringr} package).</p>
<p>The more clearly you can express the intention of your code through function names, the more easily others, including yourself in the future, will be able to read and understand the code.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># examples of names to avoid</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(x)</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(T, c, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Enumerate the arguments within <code>function()</code> and put the simplified code inside the curly braces.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>explore_penguins <span class="ot">&lt;-</span> <span class="cf">function</span> (var) {</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(penguins_num, <span class="fu">aes</span>(<span class="at">x =</span> species, <span class="at">y =</span> .data[[var]], <span class="at">color =</span> sex)) <span class="sc">+</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitterdodge</span>(), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"turquoise"</span>, <span class="st">"goldenrod1"</span>)) <span class="sc">+</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(var) </span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>üìù Use comments (#) to explain the reasoning behind your functions. Avoid explaining what the function is doing or how, as the code itself already communicates that. It is also recommended to use # to separate sections (Cmd/Ctrl + Shift + R).</p>
<ol start="5" type="1">
<li>Try with different inputs.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">explore_penguins</span>(<span class="at">var =</span> <span class="st">"body_mass_g"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite values (`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_prog_fun_files/figure-html/function_trials-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">explore_penguins</span>(<span class="at">var =</span> <span class="st">"flipper_length_mm"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite values (`stat_boxplot()`).
Removed 2 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_prog_fun_files/figure-html/function_trials-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">explore_penguins</span>(<span class="at">var =</span> <span class="st">"bill_depth_mm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite values (`stat_boxplot()`).
Removed 2 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_prog_fun_files/figure-html/function_trials-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>üí°You may want to convert these tests into formal tests. In complex functions, tests are useful to ensure that even if you make changes, the functionality has not been broken. If you‚Äôre interested, check out this link: <a href="https://r-pkgs.org/testing-basics.html" class="uri">https://r-pkgs.org/testing-basics.html</a></p>
</section>
<section id="exercise-3" class="level4" data-number="5.0.2">
<h4 data-number="5.0.2" class="anchored" data-anchor-id="exercise-3"><span class="header-section-number">5.0.2</span> Exercise</h4>
<p>Create a function to standardize (i.e., subtract the mean and divide by the standard deviation) the numerical variables of the penguins dataset.</p>
</section>
<section id="arguments" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="arguments"><span class="header-section-number">5.1</span> Arguments</h3>
<p>In general, there are two groups: those that specify the <strong>data</strong> and those that specify <strong>details</strong> of the function‚Äôs execution. Typically, those specifying data come first, followed by detail arguments. The latter group often has default values (the most common ones), for when nothing is specified.</p>
<!--# See quantile() help -->
<p>üìù The argument names should be short and descriptive. There are some names commonly used but non descriptive that are already known to most users, and it‚Äôs fine to take advantage of them.</p>
<ul>
<li><p><code>x, y, z</code>: vectors</p></li>
<li><p><code>w</code>: vector of weights</p></li>
<li><p><code>df</code>: data frame</p></li>
<li><p><code>i, j</code>: numerical indices, rows and columns, respectively</p></li>
<li><p><code>n</code>: length or row numbers</p></li>
<li><p><code>p</code>: column number</p></li>
<li><p><code>na.rm</code>: not available values</p></li>
</ul>
<p>When executing the function, arguments can be specified using the full name, a unequivocal abbreviation, or the order of their position (<em>unnamed</em> arguments), with this sequence (name &gt; abbreviation &gt; position) being the priority order when matching arguments with what is written.</p>
<p>üìù Generally, only positional order is used to specify the first arguments, the most common ones that everyone knows. If a default value for a detail argument is changed, it is advisable to always use the full name of the argument.</p>
<p>üìùUsing spaces before and after <code>=</code> and after <code>,</code> makes it much easier to identify the arguments of the function and, in general, all components.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">25</span>) <span class="sc">/</span> <span class="dv">12</span>, <span class="at">trim =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.966805</code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>,<span class="at">mean=</span><span class="dv">50</span>,<span class="at">sd=</span><span class="dv">25</span>)<span class="sc">/</span><span class="dv">12</span>,<span class="at">trim=</span><span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.966805</code></pre>
</div>
</div>
<p>There is a special argument called <code>‚Ä¶</code>, which captures any other argument that does not correspond to those named in the function. It is used to pass arguments to other functions in our function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>?plot</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">main =</span> <span class="st">"I am using an argument of title()"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>üìù Using <code>‚Ä¶</code> make functions being very flexible, but it makes necessary to carefully read the function documentation to use it. In addition, if there is a typo in an argument name, we don‚Äôt get an error message.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="at">na.mr =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>, <span class="at">na.mr =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
</section>
<section id="return-values" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="return-values"><span class="header-section-number">5.2</span> Return values</h3>
<p>The last expression executed in a function is the return value. It is the result of executing the function, unless <code>invisible()</code> is specified. Functions return only one object. If you want to obtain more, they must be grouped in one list.</p>
<!--# Can you thik of any case where using invisible() would be useful? -->
<p>üìù The function <code>return()</code> is used to explicity show what do you want to get from a function. It is recommended to use it when the return is not expected at the end of the function. For example, in the branches of an if/else structure, especially if there is a long and complex branch.</p>
<section id="exercise-4" class="level4" data-number="5.2.1">
<h4 data-number="5.2.1" class="anchored" data-anchor-id="exercise-4"><span class="header-section-number">5.2.1</span> Exercise</h4>
<p>How would you generalize the function <code>explore_penguins()</code> so you can use any data frame as input?</p>
</section>
</section>
</section>
<section id="object-oriented-programming-oop" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="object-oriented-programming-oop"><span class="header-section-number">6</span> Object-oriented programming (OOP)</h2>
<p>Most people tend to program imperatively. In imperative programming, scripts tend to be long and gradually change the state of the program. This often involves the use of temporary databases that are modified throughout the analysis process. As a result, it can be more difficult to understand what is being done in each step of the script. Object-oriented programming, used by languages, such as Java or Python, has been the most popular programming paradigm in recent decades and uses an imperative programming style.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>mypenguins <span class="ot">&lt;-</span> penguins <span class="sc">|&gt;</span> </span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">bill_volume_mm2 =</span> (bill_length_mm <span class="sc">*</span> bill_depth_mm) <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">female_penguin =</span> <span class="fu">case_when</span>(</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>      sex <span class="sc">==</span> <span class="st">"female"</span> <span class="sc">&amp;</span> body_mass_g <span class="sc">&lt;</span> <span class="dv">3600</span> <span class="sc">~</span> <span class="st">"small female"</span>,</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>      sex <span class="sc">==</span> <span class="st">"female"</span> <span class="sc">&amp;</span> body_mass_g <span class="sc">&gt;=</span> <span class="dv">3600</span> <span class="sc">~</span> <span class="st">"big female"</span>,</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span>)</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>mypenguins <span class="sc">|&gt;</span> </span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(female_penguin) <span class="sc">|&gt;</span> </span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">body_mass_mean =</span> <span class="fu">mean</span>(body_mass_g))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 2
  female_penguin body_mass_mean
  &lt;chr&gt;                   &lt;dbl&gt;
1 big female              4338.
2 small female            3277.
3 &lt;NA&gt;                      NA </code></pre>
</div>
</div>
<p>In imperative programming the most common tools to reduce duplications are <em>for loops</em> and <em>while loops</em>. <em>loops</em> are recommended to delve into the world of iterations because they make each iteration very explicit so it is clear what is happening.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/forloops.png" class="img-fluid figure-img"></p>
<figcaption>Graphic representation of the operation of <em>for</em> loops where it is clearly seen that an iteration is being carried out. Illustration by Allison Horst taken from Hadley Wickham‚Äôs talk The Joy of Functional Programming (for data science).</figcaption>
</figure>
</div>
<p>Programming a loop needs to define three different parts: the output, the sequence and the body.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>df_sam <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">b =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">c =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"double"</span>, <span class="dv">3</span>)           <span class="co"># 1. output</span></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {                        <span class="co"># 2. sequence</span></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>  output[[i]] <span class="ot">&lt;-</span> <span class="fu">first</span>(df_sam[[i]])     <span class="co"># 3. body</span></span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3 3 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we could generalize the for loop</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"double"</span>, <span class="fu">ncol</span>(df_sam))   <span class="co"># 1. output</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(df_sam)) {             <span class="co"># 2. sequence</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>  output[[i]] <span class="ot">&lt;-</span> <span class="fu">first</span>(df_sam[[i]])        <span class="co"># 3. body</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3 3 2</code></pre>
</div>
</div>
<ol type="1">
<li>Output: here we determine the output space, i.e., first we have to create the ‚Äúnotebook‚Äù where we are going to write down all the results. This is very important for efficiency since if we increase the size of the output in each iteration with <code>c()</code> or another function that adds elements, the <em>for loop</em> will be much slower.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20000</span>) {</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">c</span>(x, i)</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
   0.64    0.36    1.01 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"double"</span>, <span class="at">length =</span> <span class="dv">20000</span>)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(y)) {</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>    y[i] <span class="ot">&lt;-</span> i</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
      0       0       0 </code></pre>
</div>
</div>
<ol start="2" type="1">
<li><p>Sequence: here we determine what we want to iterate on. Each execution of the <em>for loop</em> will assign a different value of <code>seq_along(y)</code> to <em>i</em>.</p></li>
<li><p>Body: Here we determine what we want each iteration to do. The action is executed repeatedly, each time with a different value for <em>i</em>.</p></li>
</ol>
<p>There are different <a href="https://r4ds.had.co.nz/iteration.html#for-loop-variations">variations of for loops</a>: (i) modifying an existing object instead of creating a new one; (ii) loops over names or values instead of indices; (iii) loops when we do not know the length of the output; (iv) loops when we do not know the length of the input sequence, i.e., <em>while</em> loops.</p>
<p>üëÄ Some <a href="https://adv-r.hadley.nz/control-flow.html">common pitfalls</a> when using <em>for</em> loops (see 5.3.1 Common pitfalls).</p>
<p>Despite being widely used in R, <em>for</em> loops are not as important as they may be in other languages because R is a functional programming language. This means that <em>it is possible to wrap for loops in a function</em> and call that function instead of using the loop.</p>
<p>There is a belief that <em>for loops</em> are slow, but the real disadvantage of <em>for loops is that they are too flexible</em> and may execute many different tasks. Instead, each functional ({purrr}, <code>apply</code>) is designed for a specific task, so as soon as you see it in the code, you immediately know why it‚Äôs being used. That is, the main advantage is its clarity by making the code easier to write and read (see this advanced example to understand it: <a href="https://adv-r.hadley.nz/functionals.html" class="uri">https://adv-r.hadley.nz/functionals.html</a>, 9.3 Purrr style). Once we master functional programming, we will be able to solve many iteration problems with less code, more ease, and fewer errors.</p>
<p>Loops can be more explicit in the sense that you see the iteration clearly, but it takes more time to understand what you are doing. On the contrary, functionals require one more step of abstraction and may require time until we understand them. The most important thing is that you solve the problem and little by little write increasingly simpler and more elegant code. See <a href="#sec-OOP" class="quarto-xref">Section&nbsp;12.2</a> for more information on object-oriented programming.</p>
<blockquote class="blockquote">
<p>To become significantly more reliable, code must become more transparent. In particular, nested conditions and loops must be viewed with great suspicion. Complicated control flows confuse programmers. Messy code often hides bugs.</p>
<p>‚Äî Bjarne Stroustrup (<a href="https://adv-r.hadley.nz/index.html">Advanced R</a>)</p>
</blockquote>
</section>
<section id="functional-programming" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="functional-programming"><span class="header-section-number">7</span> Functional programming</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/map_frosting.png" class="img-fluid figure-img"></p>
<figcaption>Graphical representation of the operation of <code>map()</code> where the focus is on the operation performed. Illustration by Allison Horst taken from Hadley Wickham‚Äôs talk The Joy of Functional Programming (for data science)</figcaption>
</figure>
</div>
<p>In functional programming, functions are designed to perform a single specific task and are then combined by calling these functions successively for the data set. A significant advantage of this approach is that these functions can be reused in any other project, facilitating code modularity. Furthermore, when they are well documented and easily testable, it is easy to understand and maintain the program.</p>
<p>R is a functional programming language so it relies primarily on a function-centric problem-solving style (<a href="https://adv-r.hadley.nz/fp.html" class="uri">https://adv-r.hadley.nz/fp.html</a>). A functional is a function that takes a function as input and returns a vector or other type of object as output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>randomization <span class="ot">&lt;-</span> <span class="cf">function</span>(f) {</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(<span class="fu">rnorm</span>(<span class="dv">5</span>))</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="fu">randomization</span>(<span class="at">f =</span> median)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3598138</code></pre>
</div>
</div>
<p>To program a functional, first, we solve the problem for an element. Next, we generate a function that allows us to wrap the solution in a function (as we did in <a href="#sec-writefun" class="quarto-xref">Section&nbsp;5</a>). Finally, we <em>apply the function to all the elements we are interested in.</em> That is, we divide large problems into smaller problems and solve each task with one or more functions.</p>
<p>The advantage of using {purrr} instead of <em>for</em> loops is that it provides a function (functional) for each of the common data manipulation problems, and therefore each <em>for</em> loop has its own function. For example, to iterate over one argument we use the <code>map()</code> function and to iterate over two arguments we use the <code>map2()</code> function. The base R <code>apply</code> family solves similar problems, but {purrr} is more consistent and therefore easier to learn.</p>
<p>Iterating over one vector (i.e.&nbsp;vector of values or vector of elements in a list) is so common that the {purrr} package provides a family of functions (the <code>map()</code> family) for it. Remember that data frames are lists of vectors of the same length, so any calculation by rows or columns involves iterating over a vector. There is a function in {purrr} for each type of output. The suffixes indicate the type of output we want:</p>
<ul>
<li><code>map()</code> generates a list.</li>
<li><code>map_lgl()</code> generates a logical vector.</li>
<li><code>map_int()</code> generates a vector of integers.</li>
<li><code>map_dbl()</code> generates a vector of decimal numbers.</li>
<li><code>map_chr()</code> generates a character vector.</li>
<li><code>map_vec()</code> generates a vector automatically determining the type.</li>
</ul>
<p>üí°¬ø<a href="https://adv-r.hadley.nz/functionals.html#map">Why is this function called <em>map</em></a>?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_int</span>(df_sam, first)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>a b c 
3 3 2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>df_sam <span class="sc">|&gt;</span> </span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_int</span>(first)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>a b c 
3 3 2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"double"</span>, <span class="dv">3</span>)</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>  output[[i]] <span class="ot">&lt;-</span> <span class="fu">first</span>(df_sam[[i]])</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3 3 2</code></pre>
</div>
</div>
<p>Compared to a loop, the focus is on the operation being executed (<code>first()</code>), and not on the code needed to iterate over each element and save the output.</p>
</section>
<section id="iterations-over-one-argument" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="iterations-over-one-argument"><span class="header-section-number">8</span> Iterations over one argument</h2>
<p><code>map_*()</code> is vectorized over one argument, e.g.&nbsp;<code>(x)</code>. The function will operate on all elements of <code>x</code>, i.e., each value if <code>x</code> is a vector, each column if <code>x</code> is a <code>data.frame</code>, each group if <code>x</code> is a grouped <code>data.frame</code>, or each element if <code>x</code> is a list.</p>
<section id="our-first-functional-generating-lists-map" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="our-first-functional-generating-lists-map"><span class="header-section-number">8.1</span> Our first functional: generating lists, <code>map()</code></h3>
<p>It takes a vector and a function, calls the function once for each element of the vector, and returns the results in a list. <code>map(1:3, f)</code> is equivalent to <code>list(f(1), f(2), f(3))</code>. It is the equivalent of base R‚Äôs <code>lapply()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>quadratic <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, quadratic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 1

[[2]]
[1] 4

[[3]]
[1] 9

[[4]]
[1] 16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">FUN =</span> quadratic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 1

[[2]]
[1] 4

[[3]]
[1] 9

[[4]]
[1] 16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co"># some more interesting use</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 344
Columns: 8
$ species           &lt;fct&gt; Adelie, Adelie, Adelie, Adelie, Adelie, Adelie, Adel‚Ä¶
$ island            &lt;fct&gt; Torgersen, Torgersen, Torgersen, Torgersen, Torgerse‚Ä¶
$ bill_length_mm    &lt;dbl&gt; 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, ‚Ä¶
$ bill_depth_mm     &lt;dbl&gt; 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, ‚Ä¶
$ flipper_length_mm &lt;int&gt; 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186‚Ä¶
$ body_mass_g       &lt;int&gt; 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, ‚Ä¶
$ sex               &lt;fct&gt; male, female, female, NA, female, male, female, male‚Ä¶
$ year              &lt;int&gt; 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007‚Ä¶</code></pre>
</div>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># shortcut to generate an anonymous function: \(name_of_the_argument)</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(penguins, \(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$species
[1] 3

$island
[1] 3

$bill_length_mm
[1] 165

$bill_depth_mm
[1] 81

$flipper_length_mm
[1] 56

$body_mass_g
[1] 95

$sex
[1] 3

$year
[1] 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># output dataframe</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map_df</span>(penguins, \(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 8
  species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
    &lt;int&gt;  &lt;int&gt;          &lt;int&gt;         &lt;int&gt;             &lt;int&gt;       &lt;int&gt;
1       3      3            165            81                56          95
# ‚Ñπ 2 more variables: sex &lt;int&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
<p><img src="images/map.png" class="img-fluid"></p>
<section id="exercise-5" class="level4" data-number="8.1.1">
<h4 data-number="8.1.1" class="anchored" data-anchor-id="exercise-5"><span class="header-section-number">8.1.1</span> Exercise</h4>
<p>Generate a vector, a function and apply the function to each of the elements of the vector using <code>map()</code>.</p>
<p>As said before, it is possible to wrap <em>for loops</em> in a function and call that function instead of using the loop.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>imple_map <span class="ot">&lt;-</span> <span class="cf">function</span>(x, f, ...) {</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="fu">length</span>(x))</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(x)) {</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>    out[[i]] <span class="ot">&lt;-</span> <span class="fu">f</span>(x[[i]], ...)</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a><span class="fu">imple_map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, quadratic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 1

[[2]]
[1] 4

[[3]]
[1] 9

[[4]]
[1] 16</code></pre>
</div>
</div>
<p>üí°Comparing {purrr} functions with wrapping a <em>for</em> loop on your own, {purrr} functions are written in C to maximize performance, preserve names, and support some shortcuts (e.g.&nbsp;<code>\(x)</code>).</p>
</section>
<section id="exercise-6" class="level4" data-number="8.1.2">
<h4 data-number="8.1.2" class="anchored" data-anchor-id="exercise-6"><span class="header-section-number">8.1.2</span> Exercise</h4>
<p>Now that you have understood the logic of <code>map()</code>, spot the differences between the following three lines of code. What does the <code>map()</code> functional do? What differences do you detect in the code? And at the output?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(penguins, \(x) <span class="fu">mean</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mean.default(x): argument is not numeric or logical: returning NA

Warning in mean.default(x): argument is not numeric or logical: returning NA

Warning in mean.default(x): argument is not numeric or logical: returning NA</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$species
[1] NA

$island
[1] NA

$bill_length_mm
[1] NA

$bill_depth_mm
[1] NA

$flipper_length_mm
[1] NA

$body_mass_g
[1] NA

$sex
[1] NA

$year
[1] 2008.029</code></pre>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(penguins, \(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T)) <span class="co"># option 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mean.default(x, na.rm = T): argument is not numeric or logical:
returning NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mean.default(x, na.rm = T): argument is not numeric or logical:
returning NA

Warning in mean.default(x, na.rm = T): argument is not numeric or logical:
returning NA</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$species
[1] NA

$island
[1] NA

$bill_length_mm
[1] 43.92193

$bill_depth_mm
[1] 17.15117

$flipper_length_mm
[1] 200.9152

$body_mass_g
[1] 4201.754

$sex
[1] NA

$year
[1] 2008.029</code></pre>
</div>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(penguins, mean, <span class="at">na.rm =</span> T) <span class="co"># option 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mean.default(.x[[i]], ...): argument is not numeric or logical:
returning NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mean.default(.x[[i]], ...): argument is not numeric or logical:
returning NA

Warning in mean.default(.x[[i]], ...): argument is not numeric or logical:
returning NA</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$species
[1] NA

$island
[1] NA

$bill_length_mm
[1] 43.92193

$bill_depth_mm
[1] 17.15117

$flipper_length_mm
[1] 200.9152

$body_mass_g
[1] 4201.754

$sex
[1] NA

$year
[1] 2008.029</code></pre>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># map vs anonymous function</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(x, sum, <span class="fu">rnorm</span>(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5604756 -0.5604756</code></pre>
</div>
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(x, \(x) <span class="fu">sum</span>(x, <span class="fu">rnorm</span>(<span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5604756 -0.2301775</code></pre>
</div>
</div>
<p>As we have seen in the previous exercise, if we wanted to pass additional arguments to the function we are using within <code>map()</code>, one option would be through an anonymous function (see option 1 of the previous exercise). However, since <code>map()</code> includes <code>...</code> among its arguments, we can also include the additional arguments after the function inside <code>map()</code> in a much simpler way (see option 2 of the previous exercise).</p>
</section>
</section>
<section id="our-second-functional-generating-vectors-map_" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="our-second-functional-generating-vectors-map_"><span class="header-section-number">8.2</span> Our second functional: generating vectors, <code>map_*()</code></h3>
<section id="exercise-7" class="level4" data-number="8.2.1">
<h4 data-number="8.2.1" class="anchored" data-anchor-id="exercise-7"><span class="header-section-number">8.2.1</span> Exercise</h4>
<p>Take a couple of minutes to understand what the following functions do:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_lgl</span>(penguins, is.numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          species            island    bill_length_mm     bill_depth_mm 
            FALSE             FALSE              TRUE              TRUE 
flipper_length_mm       body_mass_g               sex              year 
             TRUE              TRUE             FALSE              TRUE </code></pre>
</div>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>penguins_num <span class="ot">&lt;-</span> penguins[ , <span class="fu">map_lgl</span>(penguins, is.numeric)] </span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(penguins_num, median, <span class="at">na.rm =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   bill_length_mm     bill_depth_mm flipper_length_mm       body_mass_g 
            44.45             17.30            197.00           4050.00 
             year 
          2008.00 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_chr</span>(penguins, class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          species            island    bill_length_mm     bill_depth_mm 
         "factor"          "factor"         "numeric"         "numeric" 
flipper_length_mm       body_mass_g               sex              year 
        "integer"         "integer"          "factor"         "integer" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_int</span>(penguins, \(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          species            island    bill_length_mm     bill_depth_mm 
                3                 3               165                81 
flipper_length_mm       body_mass_g               sex              year 
               56                95                 3                 3 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span> <span class="sc">|&gt;</span> </span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_vec</span>(\(x) <span class="fu">as.Date</span>(<span class="fu">ISOdate</span>(x <span class="sc">+</span> <span class="dv">2024</span>, <span class="dv">05</span>, <span class="dv">13</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2025-05-13" "2026-05-13" "2027-05-13" "2028-05-13"</code></pre>
</div>
</div>
<p>Arguments that vary for each run are written before the function, and arguments that are the same for each run are written after the function (e.g.&nbsp;<code>na.rm = T</code>).</p>
<p><img src="images/map+fix.png" class="img-fluid"></p>
<p>Base R has two functions from the <code>apply()</code> family that can return vectors: <code>sapply()</code> and <code>vapply()</code>. We recommend avoiding <code>sapply()</code> because it tries to simplify the result and chooses a default output format, potentially returning a list, a vector or a matrix. <code>vapply()</code> is safer because it allows you to indicate the output format with FUN.VALUE. The main disadvantage of <code>vapply()</code> is that we need to specify more arguments than in <code>map_*()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(penguins_num, median, <span class="at">na.rm =</span> T, <span class="at">FUN.VALUE =</span> <span class="fu">double</span>(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   bill_length_mm     bill_depth_mm flipper_length_mm       body_mass_g 
            44.45             17.30            197.00           4050.00 
             year 
          2008.00 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(penguins_num, median, <span class="at">na.rm =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   bill_length_mm     bill_depth_mm flipper_length_mm       body_mass_g 
            44.45             17.30            197.00           4050.00 
             year 
          2008.00 </code></pre>
</div>
</div>
<p>Working with lists is very common in R. In fact the default output of <code>map()</code> is lists. However, lists can sometimes be messy, e.g., when we lose the name of each element in the list. The function <a href="https://tidyr.tidyverse.org/reference/nest.html"><code>nest()</code></a> of {tidyr} allows us to work with list-columns in data frames, generating a row for each group defined by the non-nested columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 344
Columns: 8
$ species           &lt;fct&gt; Adelie, Adelie, Adelie, Adelie, Adelie, Adelie, Adel‚Ä¶
$ island            &lt;fct&gt; Torgersen, Torgersen, Torgersen, Torgersen, Torgerse‚Ä¶
$ bill_length_mm    &lt;dbl&gt; 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, ‚Ä¶
$ bill_depth_mm     &lt;dbl&gt; 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, ‚Ä¶
$ flipper_length_mm &lt;int&gt; 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186‚Ä¶
$ body_mass_g       &lt;int&gt; 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, ‚Ä¶
$ sex               &lt;fct&gt; male, female, female, NA, female, male, female, male‚Ä¶
$ year              &lt;int&gt; 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007‚Ä¶</code></pre>
</div>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove na's</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>penguins_nona <span class="ot">&lt;-</span> penguins <span class="sc">|&gt;</span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>penguins_nested <span class="ot">&lt;-</span> penguins_nona <span class="sc">|&gt;</span></span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">|&gt;</span></span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">|&gt;</span> <span class="co"># nest() generates list-columns in the data frames</span></span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">lm_obj =</span> <span class="fu">map</span>(data, \(df) <span class="fu">lm</span>(</span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a>      bill_length_mm <span class="sc">~</span> body_mass_g,</span>
<span id="cb190-11"><a href="#cb190-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> df))</span>
<span id="cb190-12"><a href="#cb190-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb190-13"><a href="#cb190-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-14"><a href="#cb190-14" aria-hidden="true" tabindex="-1"></a><span class="co"># select each item in the list</span></span>
<span id="cb190-15"><a href="#cb190-15" aria-hidden="true" tabindex="-1"></a>penguins_nested[[<span class="st">"lm_obj"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]

Call:
lm(formula = bill_length_mm ~ body_mass_g, data = df)

Coefficients:
(Intercept)  body_mass_g  
   27.11291      0.00316  


[[2]]

Call:
lm(formula = bill_length_mm ~ body_mass_g, data = df)

Coefficients:
(Intercept)  body_mass_g  
   26.53788      0.00413  


[[3]]

Call:
lm(formula = bill_length_mm ~ body_mass_g, data = df)

Coefficients:
(Intercept)  body_mass_g  
  32.174193     0.004463  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>penguins_nested <span class="sc">|&gt;</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="st">"lm_obj"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]

Call:
lm(formula = bill_length_mm ~ body_mass_g, data = df)

Coefficients:
(Intercept)  body_mass_g  
   27.11291      0.00316  


[[2]]

Call:
lm(formula = bill_length_mm ~ body_mass_g, data = df)

Coefficients:
(Intercept)  body_mass_g  
   26.53788      0.00413  


[[3]]

Call:
lm(formula = bill_length_mm ~ body_mass_g, data = df)

Coefficients:
(Intercept)  body_mass_g  
  32.174193     0.004463  </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="iterations-over-multiple-arguments" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="iterations-over-multiple-arguments"><span class="header-section-number">9</span> Iterations over multiple arguments</h2>
<section id="our-third-functional-two-inputs-map2" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="our-third-functional-two-inputs-map2"><span class="header-section-number">9.1</span> Our third functional: two inputs, <code>map2()</code></h3>
<p><code>map2()</code> is vectorized over two arguments, e.g.&nbsp;<code>(x, y)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>power <span class="ot">&lt;-</span> <span class="cf">function</span>(base, exponent) {</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a> base <span class="sc">^</span> exponent</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">5</span>)</span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">5</span>)</span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a><span class="fu">map2</span>(x, y, power)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 27

[[2]]
[1] 2

[[3]]
[1] 25

[[4]]
[1] 1024

[[5]]
[1] 1</code></pre>
</div>
</div>
<p>‚ö°¬°Important! The first iteration corresponds to the first value of the vector <code>x</code> and the first value of the vector <code>y</code>. The second iteration corresponds to the second value of the vector <code>x</code> and the second value of the vector <code>y</code>. Not all possible combinations are made between both vectors.</p>
<p><img src="images/map2.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>imple_map2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, f, ...) {</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="fu">length</span>(x))</span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(x)) {</span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>    out[[i]] <span class="ot">&lt;-</span> <span class="fu">f</span>(x[[i]], y[[i]], ...)</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a><span class="fu">imple_map2</span>(x, y, power)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 27

[[2]]
[1] 2

[[3]]
[1] 25

[[4]]
[1] 1024

[[5]]
[1] 1</code></pre>
</div>
</div>
<section id="sec-exercise-map2" class="level4" data-number="9.1.1">
<h4 data-number="9.1.1" class="anchored" data-anchor-id="sec-exercise-map2"><span class="header-section-number">9.1.1</span> Exercise</h4>
<p>From the code shown below, generate a <code>data.frame</code>, adding a column to the <code>data.frame</code> with the name that we have assigned to each list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>penguins_list <span class="ot">&lt;-</span> penguins <span class="sc">|&gt;</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_split</span>(species)</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="co"># we assign names to lists</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(penguins_list) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"p1"</span>, <span class="st">"p2"</span>, <span class="st">"p3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="advanced-exercise" class="level4" data-number="9.1.2">
<h4 data-number="9.1.2" class="anchored" data-anchor-id="advanced-exercise"><span class="header-section-number">9.1.2</span> Advanced exercise</h4>
<p>Calculate the correlation between the predictions stored in the list-column <code>pred</code> and <code>bill_length_mm</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>penguins_nested <span class="ot">&lt;-</span> penguins <span class="sc">|&gt;</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">|&gt;</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">|&gt;</span> </span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">lm_obj =</span> <span class="fu">map</span>(data, \(df) <span class="fu">lm</span>(</span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a>      bill_length_mm <span class="sc">~</span> body_mass_g,</span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> df)),</span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred =</span> <span class="fu">map2</span>(lm_obj, data,</span>
<span id="cb199-9"><a href="#cb199-9" aria-hidden="true" tabindex="-1"></a>                \(x, y) <span class="fu">predict</span>(x, y))</span>
<span id="cb199-10"><a href="#cb199-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb199-11"><a href="#cb199-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-12"><a href="#cb199-12" aria-hidden="true" tabindex="-1"></a><span class="co"># unnest()</span></span>
<span id="cb199-13"><a href="#cb199-13" aria-hidden="true" tabindex="-1"></a>penguins_nested <span class="sc">|&gt;</span> </span>
<span id="cb199-14"><a href="#cb199-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(pred) <span class="sc">|&gt;</span> </span>
<span id="cb199-15"><a href="#cb199-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(data, lm_obj))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 √ó 2
# Groups:   species [3]
   species  pred
   &lt;fct&gt;   &lt;dbl&gt;
 1 Adelie   38.9
 2 Adelie   39.1
 3 Adelie   37.4
 4 Adelie   NA  
 5 Adelie   38.0
 6 Adelie   38.6
 7 Adelie   38.6
 8 Adelie   41.9
 9 Adelie   38.1
10 Adelie   40.5
# ‚Ñπ 334 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="our-fourth-functional-multiple-inputs-pmap" class="level3" data-number="9.2">
<h3 data-number="9.2" class="anchored" data-anchor-id="our-fourth-functional-multiple-inputs-pmap"><span class="header-section-number">9.2</span> Our fourth functional: multiple inputs, <code>pmap()</code></h3>
<p>Takes a list with any number of input arguments.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># they are equivalent</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map2</span>(x, y, power)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 27

[[2]]
[1] 2

[[3]]
[1] 25

[[4]]
[1] 1024

[[5]]
[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pmap</span>(<span class="fu">list</span>(x, y), power)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 27

[[2]]
[1] 2

[[3]]
[1] 25

[[4]]
[1] 1024

[[5]]
[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">5</span>)</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ?rnorm</span></span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a><span class="fu">pmap</span>(<span class="fu">list</span>(<span class="at">n =</span> x, <span class="at">mean =</span> y, <span class="at">sd =</span> z), rnorm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 6.718488 2.673102 2.648274

[[2]]
[1] 1.366165 3.561110

[[3]]
[1] -6.636353 10.450922  4.519062 14.641683  4.745484

[[4]]
[1]  5.9528517  0.8044274 10.1790530  8.3021594

[[5]]
[1] 3.944314</code></pre>
</div>
</div>
<p>üí°If we do not name the list elements, <code>pmap()</code> will use the list elements in their order for consecutive arguments to the function. In any case, it is a good practice to name them so that it is very clear what the function will do.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>args3 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">mean =</span> x, <span class="at">sd =</span> y, <span class="at">n =</span> z) </span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>args3 <span class="sc">|&gt;</span> </span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pmap</span>(rnorm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 0.6468533 0.7994903 2.3524038

[[2]]
[1] 1.6650872 0.9143009

[[3]]
[1] 4.829153 7.141221 4.709213 2.668910 3.362969

[[4]]
[1]  7.424680  2.399718 -2.557612  1.001958

[[5]]
[1] 0.4823572</code></pre>
</div>
</div>
<p><img src="images/pmap.png" class="img-fluid"></p>
<section id="exercise-8" class="level4" data-number="9.2.1">
<h4 data-number="9.2.1" class="anchored" data-anchor-id="exercise-8"><span class="header-section-number">9.2.1</span> Exercise</h4>
<p>Transform the <code>map2()</code> that you have generated in the exercise <a href="#sec-exercise-map2" class="quarto-xref">Section&nbsp;9.1.1</a> to <code>pmap()</code>.</p>
</section>
</section>
</section>
<section id="iterations-without-output" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="iterations-without-output"><span class="header-section-number">10</span> Iterations without output</h2>
<section id="our-fifth-functional-walk-walk2-and-pwalk" class="level3" data-number="10.1">
<h3 data-number="10.1" class="anchored" data-anchor-id="our-fifth-functional-walk-walk2-and-pwalk"><span class="header-section-number">10.1</span> Our fifth functional: <code>walk()</code>, <code>walk2()</code> and <code>pwalk()</code></h3>
<p><em>Walk</em> family functionals are used when we want to use functions for their side effects (e.g.&nbsp;<code>ggsave()</code>) and not for their return value. What is important is the action and not the return value or object in R.</p>
<section id="exercise-9" class="level4" data-number="10.1.1">
<h4 data-number="10.1.1" class="anchored" data-anchor-id="exercise-9"><span class="header-section-number">10.1.1</span> Exercise</h4>
<p>Based on what it says in the definition about the <code>walk()</code> family, run this code and understand what it does.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>penguins_nested <span class="ot">&lt;-</span> penguins <span class="sc">|&gt;</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">|&gt;</span></span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>()</span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a><span class="co"># penguins_nested |&gt; </span></span>
<span id="cb209-6"><a href="#cb209-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   pluck("data") |&gt; </span></span>
<span id="cb209-7"><a href="#cb209-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   pluck(1)</span></span>
<span id="cb209-8"><a href="#cb209-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-9"><a href="#cb209-9" aria-hidden="true" tabindex="-1"></a>penguins_nested_str <span class="ot">&lt;-</span> penguins_nested <span class="sc">|&gt;</span> </span>
<span id="cb209-10"><a href="#cb209-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">path =</span> <span class="fu">str_glue</span>(<span class="st">"penguins_{species}.csv"</span>))</span>
<span id="cb209-11"><a href="#cb209-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-12"><a href="#cb209-12" aria-hidden="true" tabindex="-1"></a>penguins_nested_str</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 3
# Groups:   species [3]
  species   data               path                  
  &lt;fct&gt;     &lt;list&gt;             &lt;glue&gt;                
1 Adelie    &lt;tibble [152 √ó 7]&gt; penguins_Adelie.csv   
2 Gentoo    &lt;tibble [124 √ó 7]&gt; penguins_Gentoo.csv   
3 Chinstrap &lt;tibble [68 √ó 7]&gt;  penguins_Chinstrap.csv</code></pre>
</div>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">walk2</span>(penguins_nested_str<span class="sc">$</span>data, penguins_nested_str<span class="sc">$</span>path, write_csv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="advanced-exercise-1" class="level4" data-number="10.1.2">
<h4 data-number="10.1.2" class="anchored" data-anchor-id="advanced-exercise-1"><span class="header-section-number">10.1.2</span> Advanced exercise</h4>
<p>Generate an example where you use <code>walk2()</code> or <code>pwalk()</code> to save multiple plots generated with <code>ggplot()</code>. Hint: the first entry will be the plot you want to save and the second the name of the file you want to give it.</p>
</section>
</section>
</section>
<section id="function-operators-and-other-functionals" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="function-operators-and-other-functionals"><span class="header-section-number">11</span> Function operators and other functionals</h2>
<section id="more-variants-of-map-modify-and-imap" class="level3" data-number="11.1">
<h3 data-number="11.1" class="anchored" data-anchor-id="more-variants-of-map-modify-and-imap"><span class="header-section-number">11.1</span> More variants of <code>map()</code>: <code>modify()</code> and <code>imap()</code></h3>
<p><code>modify()</code> and <code>imap()</code> are also map family functions. <code>modify()</code> is analogous to <code>map()</code> but returns the same output type as the input type.</p>
<p><code>imap()</code> is used to iterate over indexes, both numeric indexes and names. <code>imap(x, f)</code> is analogous to <code>map2(x, names(x), f)</code> when <code>x</code> has names and <code>map2(x, seq_along(x), f)</code> when it does not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># modify</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, quadratic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 1

[[2]]
[1] 4

[[3]]
[1] 9

[[4]]
[1] 16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modify</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, quadratic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1  4  9 16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># imap</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map2</span>(penguins, <span class="fu">names</span>(penguins), \(x, y) <span class="fu">paste</span>(<span class="st">"The column"</span>, y, <span class="st">"has"</span>, <span class="fu">length</span>(<span class="fu">unique</span>(x)), <span class="st">"unique values counting NA's"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$species
[1] "The column species has 3 unique values counting NA's"

$island
[1] "The column island has 3 unique values counting NA's"

$bill_length_mm
[1] "The column bill_length_mm has 165 unique values counting NA's"

$bill_depth_mm
[1] "The column bill_depth_mm has 81 unique values counting NA's"

$flipper_length_mm
[1] "The column flipper_length_mm has 56 unique values counting NA's"

$body_mass_g
[1] "The column body_mass_g has 95 unique values counting NA's"

$sex
[1] "The column sex has 3 unique values counting NA's"

$year
[1] "The column year has 3 unique values counting NA's"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">imap</span>(penguins, \(x, y) <span class="fu">paste</span>(<span class="st">"The column"</span>, y, <span class="st">"has"</span>, <span class="fu">length</span>(<span class="fu">unique</span>(x)), <span class="st">"unique values counting NA's"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$species
[1] "The column species has 3 unique values counting NA's"

$island
[1] "The column island has 3 unique values counting NA's"

$bill_length_mm
[1] "The column bill_length_mm has 165 unique values counting NA's"

$bill_depth_mm
[1] "The column bill_depth_mm has 81 unique values counting NA's"

$flipper_length_mm
[1] "The column flipper_length_mm has 56 unique values counting NA's"

$body_mass_g
[1] "The column body_mass_g has 95 unique values counting NA's"

$sex
[1] "The column sex has 3 unique values counting NA's"

$year
[1] "The column year has 3 unique values counting NA's"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>df_sam <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">b =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">c =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_sam) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb220-8"><a href="#cb220-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-9"><a href="#cb220-9" aria-hidden="true" tabindex="-1"></a><span class="fu">imap</span>(df_sam, \(x, y) <span class="fu">paste</span>(<span class="st">"The column"</span>, y, <span class="st">"has"</span>, <span class="fu">length</span>(<span class="fu">unique</span>(x)), <span class="st">"unique values counting NA's"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "The column 1 has 5 unique values counting NA's"

[[2]]
[1] "The column 2 has 5 unique values counting NA's"

[[3]]
[1] "The column 3 has 5 unique values counting NA's"</code></pre>
</div>
</div>
<p>In this course we do not delve into <code>modify()</code> and <code>imap()</code> because with the other functionals we have seen we can address practically all iteration problems. However, if anyone is interested you can check out <a href="https://adv-r.hadley.nz/functionals.html" class="uri">https://adv-r.hadley.nz/functionals.html</a>, 9.4 Map variants.</p>
<p>üí°Examples of some specific tasks with {purrr}: <a href="https://r4ds.hadley.nz/iteration" class="uri">https://r4ds.hadley.nz/iteration</a></p>
</section>
<section id="predicate-functionals-and-more-useful-stuff" class="level3" data-number="11.2">
<h3 data-number="11.2" class="anchored" data-anchor-id="predicate-functionals-and-more-useful-stuff"><span class="header-section-number">11.2</span> Predicate functionals and more useful stuff</h3>
<p>Predicates are functions that return a single TRUE or FALSE (e.g., <code>is.character()</code>). Thus, a functional predicate applies a predicate to each element of a vector: <code>keep()</code>, <code>discard()</code>, <code>some()</code>, <code>every()</code>, <code>detect()</code>, <code>detect_index()</code> ‚Ä¶ For more information see: <a href="https://r4ds.had.co.nz/iteration.html" class="uri">https://r4ds.had.co.nz/iteration.html</a>, 21.9.1 Predicate functions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep</span>(is.numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 √ó 5
   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g  year
            &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;int&gt;
 1           39.1          18.7               181        3750  2007
 2           39.5          17.4               186        3800  2007
 3           40.3          18                 195        3250  2007
 4           NA            NA                  NA          NA  2007
 5           36.7          19.3               193        3450  2007
 6           39.3          20.6               190        3650  2007
 7           38.9          17.8               181        3625  2007
 8           39.2          19.6               195        4675  2007
 9           34.1          18.1               193        3475  2007
10           42            20.2               190        4250  2007
# ‚Ñπ 334 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discard</span>(is.numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 √ó 3
   species island    sex   
   &lt;fct&gt;   &lt;fct&gt;     &lt;fct&gt; 
 1 Adelie  Torgersen male  
 2 Adelie  Torgersen female
 3 Adelie  Torgersen female
 4 Adelie  Torgersen &lt;NA&gt;  
 5 Adelie  Torgersen female
 6 Adelie  Torgersen male  
 7 Adelie  Torgersen female
 8 Adelie  Torgersen male  
 9 Adelie  Torgersen &lt;NA&gt;  
10 Adelie  Torgersen &lt;NA&gt;  
# ‚Ñπ 334 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">every</span>(is.numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p><code>dplyr::across()</code> is similar to <code>map()</code> but instead of doing something with each element of a vector, data frame or list, it does something only with each column in a data frame.</p>
<p><code>reduce()</code> is a useful way to generalize a function that works with two inputs (binary function) to work with any number of inputs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>penguins_scaled <span class="ot">&lt;-</span> penguins <span class="sc">|&gt;</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), scale))</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>ls <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"Vero"</span>, <span class="st">"Julen"</span>, <span class="st">"Monchi"</span>), <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">140</span>, <span class="dv">200</span>)),</span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex =</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"Vero"</span>, <span class="st">"Julen"</span>, <span class="st">"Monchi"</span>), <span class="at">sex =</span> <span class="fu">c</span>(<span class="st">"F"</span>, <span class="st">"M"</span>, <span class="st">"M"</span>)),</span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"Vero"</span>, <span class="st">"Julen"</span>, <span class="st">"Monchi"</span>), <span class="at">height =</span> <span class="fu">c</span>(<span class="st">"180"</span>, <span class="st">"150"</span>, <span class="st">"500"</span>))</span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-10"><a href="#cb228-10" aria-hidden="true" tabindex="-1"></a>ls <span class="sc">|&gt;</span> </span>
<span id="cb228-11"><a href="#cb228-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(full_join, <span class="at">by =</span> <span class="st">"name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 4
  name     age sex   height
  &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
1 Vero     100 F     180   
2 Julen    140 M     150   
3 Monchi   200 M     500   </code></pre>
</div>
</div>
<section id="function-operators" class="level4" data-number="11.2.1">
<h4 data-number="11.2.1" class="anchored" data-anchor-id="function-operators"><span class="header-section-number">11.2.1</span> Function operators</h4>
<p>When we use <code>map()</code> functions to repeat many operations, the probability that one of those operations fails increases and we will not get any output. {purrr} provides some function operators in the form of adverbs to ensure that an error doesn‚Äôt ruin the entire process: <code>safely()</code>, <code>possibly()</code>, <code>quietly()</code>. For more information see: <a href="https://r4ds.had.co.nz/iteration.html" class="uri">https://r4ds.had.co.nz/iteration.html</a>, 21.6 Dealing with failure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">10</span>, <span class="st">"b"</span>, <span class="dv">3</span>)</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>x <span class="sc">|&gt;</span> </span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `map()`:
‚Ñπ In index: 2.
Caused by error:
! non-numeric argument to mathematical function</code></pre>
</div>
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">|&gt;</span> </span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="fu">safely</span>(log))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[[1]]$result
[1] 2.302585

[[1]]$error
NULL


[[2]]
[[2]]$result
NULL

[[2]]$error
&lt;simpleError in .Primitive("log")(x, base): non-numeric argument to mathematical function&gt;


[[3]]
[[3]]$result
[1] 1.098612

[[3]]$error
NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">|&gt;</span> </span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="fu">safely</span>(log)) <span class="sc">|&gt;</span> </span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transpose</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$result
$result[[1]]
[1] 2.302585

$result[[2]]
NULL

$result[[3]]
[1] 1.098612


$error
$error[[1]]
NULL

$error[[2]]
&lt;simpleError in .Primitive("log")(x, base): non-numeric argument to mathematical function&gt;

$error[[3]]
NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">|&gt;</span> </span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="fu">possibly</span>(log, <span class="cn">NA_real_</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 2.302585

[[2]]
[1] NA

[[3]]
[1] 1.098612</code></pre>
</div>
</div>
</section>
<section id="exercise-10" class="level4" data-number="11.2.2">
<h4 data-number="11.2.2" class="anchored" data-anchor-id="exercise-10"><span class="header-section-number">11.2.2</span> Exercise</h4>
<p>Use any variant of <code>map()</code> along with a function operator to the penguins database.</p>
</section>
</section>
</section>
<section id="further-information" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="further-information"><span class="header-section-number">12</span> Further information</h2>
<section id="parallelization" class="level3" data-number="12.1">
<h3 data-number="12.1" class="anchored" data-anchor-id="parallelization"><span class="header-section-number">12.1</span> Parallelization</h3>
<p>Different CPU cores (<em>Central Processing Unit</em>) can be used to run the same process with different sets of data in parallel, speeding up long tasks. Some tasks are particularly well suited for parallelization, such as, those that are repetitive and have little or no dependence on each other, other than the source of the input data, allowing them to be easily split into parallel tasks. These tasks are usually those that can be solved through iterations like those we have seen previously. In theory, the process speeds up in proportion to the number of cores, but in practice, other factors must be taken into account, such as, the time consumed in transferring data to each process and the time spent gathering the results of the different processes.</p>
<p>R was originally designed to run on a single CPU process because when it was developed, CPUs generally had a single core and parallel computing was not as common or developed as it is today. Therefore, to take advantage of parallelization in R, we need to resort to additional packages. However, it is important to note that these packages may be limited in their use to specific cases and data types.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel) <span class="co"># detect number of cores</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(future) <span class="co"># set number of cores</span></span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(furrr) <span class="co"># parallelization with map</span></span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a><span class="fu">detectCores</span>()</span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a><span class="co"># function to cube a number</span></span>
<span id="cb238-8"><a href="#cb238-8" aria-hidden="true" tabindex="-1"></a>cube <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb238-9"><a href="#cb238-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">1</span>) <span class="co"># simulation of a computationally intensive task</span></span>
<span id="cb238-10"><a href="#cb238-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x <span class="sc">^</span> <span class="dv">3</span>)</span>
<span id="cb238-11"><a href="#cb238-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb238-12"><a href="#cb238-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-13"><a href="#cb238-13" aria-hidden="true" tabindex="-1"></a><span class="co"># sequential</span></span>
<span id="cb238-14"><a href="#cb238-14" aria-hidden="true" tabindex="-1"></a>time_initial <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb238-15"><a href="#cb238-15" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, cube)</span>
<span id="cb238-16"><a href="#cb238-16" aria-hidden="true" tabindex="-1"></a>time_final <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb238-17"><a href="#cb238-17" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Computing time:"</span>, <span class="fu">round</span>(time_final <span class="sc">-</span> time_initial, <span class="dv">1</span>), <span class="st">"seconds"</span>)</span>
<span id="cb238-18"><a href="#cb238-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-19"><a href="#cb238-19" aria-hidden="true" tabindex="-1"></a><span class="co"># establish how we are going to resolve the process</span></span>
<span id="cb238-20"><a href="#cb238-20" aria-hidden="true" tabindex="-1"></a><span class="co"># here we will use 3 cores but depending on the number of cores available on your computer it can be modified</span></span>
<span id="cb238-21"><a href="#cb238-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="dv">3</span>)</span>
<span id="cb238-22"><a href="#cb238-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-23"><a href="#cb238-23" aria-hidden="true" tabindex="-1"></a><span class="co"># future_map to run in parallel</span></span>
<span id="cb238-24"><a href="#cb238-24" aria-hidden="true" tabindex="-1"></a>time_initial <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb238-25"><a href="#cb238-25" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">future_map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, cube)</span>
<span id="cb238-26"><a href="#cb238-26" aria-hidden="true" tabindex="-1"></a>time_final <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb238-27"><a href="#cb238-27" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Computing time:"</span>, <span class="fu">round</span>(time_final <span class="sc">-</span> time_initial, <span class="dv">1</span>), <span class="st">"seconds</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb238-28"><a href="#cb238-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-29"><a href="#cb238-29" aria-hidden="true" tabindex="-1"></a><span class="co"># we see that the computing time has been reduced by almost 1/3 (approx. 1/number of cores)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The information presented here about parallel programming is explained in more detail in: <a href="https://emf.creaf.cat/workflows/r_parallel_computing_tech_doc/" class="uri">https://emf.creaf.cat/workflows/r_parallel_computing_tech_doc/</a></p>
</section>
<section id="sec-OOP" class="level3" data-number="12.2">
<h3 data-number="12.2" class="anchored" data-anchor-id="sec-OOP"><span class="header-section-number">12.2</span> More information about Object-Oriented Programming (OOP)</h3>
<blockquote class="blockquote">
<p>- Everything that exists is an object.</p>
<p>‚Äî John Chambers</p>
<p>- However, not everything is object-oriented</p>
</blockquote>
<p>In R, functional programming is often more relevant than OOP, as complex problems are often addressed by decomposing them into simple functions rather than simple objects.</p>
<p>The main reason for using OOP is <em>polymorphism</em> (from the Latin ‚Äúmany forms‚Äù). Polymorphism allows a developer to consider a function‚Äôs interface separately from its implementation, making it easier to use the same function with different input types. To understand this, try running the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(penguins<span class="sc">$</span>bill_depth_mm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  13.10   15.60   17.30   17.15   18.70   21.50       2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(penguins<span class="sc">$</span>sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>female   male   NA's 
   165    168     11 </code></pre>
</div>
</div>
<p>You might think that <code>summary()</code> uses a series of <code>if-else</code> statements depending on the type of the input data, but in this case only the original author could add new implementations. However, an OOP system allows any developer to extend the interface by creating implementations for new input types.</p>
<p>In OOP systems, the type of an object is called its <em>class</em>, and a specific implementation for a class is known as a <em>method</em>. Broadly speaking, a class defines the characteristics of an object (what is it?) and methods describe the actions that object can perform (what does it do?).</p>
<p>Base R provides three OOP systems (S3 ‚Äìwhich is the most used-, S4 and RC), although there are also other OOP systems provided by different CRAN packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sloop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'sloop' was built under R version 4.2.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.object</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="co"># base object but not object oriented</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">otype</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="co"># base object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "base"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">"class"</span>) <span class="co"># without class</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.object</span>(penguins) <span class="co"># object-oriented</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">otype</span>(penguins) <span class="co"># S3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "S3"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(penguins, <span class="st">"class"</span>) <span class="co"># with clase</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftype</span>(summary) <span class="co"># generic function S3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "S3"      "generic"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a generic function defines the interface, which uses a different implementation (method) depending on the class of the argument. Remember the idea of polymorphism that we have seen before ;)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>üí°More detailed information on <a href="https://adv-r.hadley.nz/oo.html">OOP</a> and <a href="https://adv-r.hadley.nz/oo-tradeoffs.html">trade-offs between some OOP systems</a></p>
</section>
<section id="links-of-interest" class="level3" data-number="12.3">
<h3 data-number="12.3" class="anchored" data-anchor-id="links-of-interest"><span class="header-section-number">12.3</span> Links of interest</h3>
<ul>
<li><p><a href="https://rstudio-education.github.io/hopr/basics.html">Hands-On Programming with R (basics)</a></p></li>
<li><p><a href="https://r4ds.had.co.nz/functions.html">R for data Science (functions)</a></p></li>
<li><p><a href="https://adv-r.hadley.nz/functions.html">Advanced R (functions)</a></p></li>
<li><p><a href="https://cran.r-project.org/web/packages/dplyr/vignettes/programming.html">Tidy evaluation to program functions with tidyverse</a></p></li>
<li><p><a href="https://r4ds.had.co.nz/iteration.html">R for data Science (iteration)</a></p></li>
<li><p><a href="https://adv-r.hadley.nz/functionals.html">Advanced R (functionals)</a></p></li>
<li><p><a href="https://www.tidyverse.org/blog/2022/12/purrr-1-0-0/">purrr 1.0.0</a></p></li>
<li><p><a href="https://www.rebeccabarter.com/blog/2019-08-19_purrr">Learn to purrr (Rebecca Barter)</a></p></li>
<li><p><a href="http://adv-r.had.co.nz/Style.html">Style guide</a></p></li>
<li><p><a href="https://emf.creaf.cat/workflows/r_parallel_computing_tech_doc/">Parallel computation in R</a></p></li>
<li><p><a href="https://adv-r.hadley.nz/oo.html">Advanced R (Object-oriented programming)</a></p></li>
</ul>
<p>This course is primarily based on the first edition of the book <a href="https://r4ds.had.co.nz/">R for Data Science</a> by Hadley Wickham &amp; Garrett Grolemund and the second edition of the book <a href="https:%20//adv-r.hadley.nz/index.html">Advanced R</a> by Hadley Wickham.</p>
<hr>
<details>
<summary>
Session Info
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.time</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-06-05 11:47:30 CEST"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.2.2 (2022-10-31 ucrt)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 19045)

Matrix products: default

locale:
[1] LC_COLLATE=English_United Kingdom.utf8 
[2] LC_CTYPE=English_United Kingdom.utf8   
[3] LC_MONETARY=English_United Kingdom.utf8
[4] LC_NUMERIC=C                           
[5] LC_TIME=English_United Kingdom.utf8    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] sloop_1.0.1          palmerpenguins_0.1.1 forcats_0.5.1       
 [4] stringr_1.5.0        dplyr_1.1.2          purrr_1.0.1         
 [7] readr_2.1.2          tidyr_1.3.0          tibble_3.2.1        
[10] ggplot2_3.4.2        tidyverse_1.3.2     

loaded via a namespace (and not attached):
 [1] lubridate_1.8.0     assertthat_0.2.1    digest_0.6.29      
 [4] utf8_1.2.3          R6_2.5.1            cellranger_1.1.0   
 [7] backports_1.4.1     reprex_2.0.1        evaluate_0.18      
[10] httr_1.4.3          pillar_1.9.0        rlang_1.1.1        
[13] googlesheets4_1.0.0 readxl_1.4.0        rstudioapi_0.13    
[16] rmarkdown_2.16      labeling_0.4.2      googledrive_2.0.0  
[19] htmlwidgets_1.5.4   bit_4.0.5           munsell_0.5.0      
[22] broom_1.0.0         compiler_4.2.2      modelr_0.1.8       
[25] xfun_0.39           pkgconfig_2.0.3     htmltools_0.5.3    
[28] tidyselect_1.2.0    codetools_0.2-18    fansi_1.0.4        
[31] crayon_1.5.2        tzdb_0.3.0          dbplyr_2.2.1       
[34] withr_2.5.0         grid_4.2.2          jsonlite_1.8.0     
[37] gtable_0.3.3        lifecycle_1.0.3     DBI_1.1.3          
[40] magrittr_2.0.3      scales_1.2.1        cli_3.6.1          
[43] stringi_1.7.12      vroom_1.5.7         farver_2.1.1       
[46] fs_1.5.2            xml2_1.3.3          ellipsis_0.3.2     
[49] generics_0.1.3      vctrs_0.6.3         tools_4.2.2        
[52] bit64_4.0.5         glue_1.6.2          hms_1.1.1          
[55] parallel_4.2.2      fastmap_1.1.0       yaml_2.3.5         
[58] colorspace_2.1-0    gargle_1.2.0        rvest_1.0.2        
[61] knitr_1.40.1        haven_2.5.0        </code></pre>
</div>
</div>
</details>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>